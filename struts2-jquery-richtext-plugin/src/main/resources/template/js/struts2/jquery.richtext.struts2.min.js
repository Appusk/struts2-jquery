/*

 jquery.richtext.struts2.js

 Integration of richtext editor with struts 2

 Requires use of jquery.struts2.js

 Copyright (c) 2010 - 2015 Johannes Geppert http://www.jgeppert.com

 Dual licensed under the MIT and GPL licenses:
   http://www.opensource.org/licenses/mit-license.php
   http://www.gnu.org/licenses/gpl.html

*/
'use strict';(function(f){f.struts2_jquery_richtext={editors:[],editorsTinymce:[],ckeditorTimer:void 0,clean:function(d){var a=this;window.CKEDITOR&&f.each(a.editors,function(c,g){var b=CKEDITOR.instances[g];0!==d.length&&b&&b.textarea===d[0]||(a.editors.splice(c),delete CKEDITOR.instances[g])})},ckeditor:function(d,a){var c=this,g,b="s2j_ckeditor_"+a.id,e;c.log("ckeditor for : "+a.id);c.require("js/ckeditor/ckeditor.js");c.require("js/ckeditor/adapters/jquery.js");(g=CKEDITOR.instances[a.id])&&CKEDITOR.remove(g);
c.clean(d);e=function(){c.editors[c.editors.length]=a.id;if(a.onEditorReadyTopics){var b={};c.publishTopic(d,a.onEditorReadyTopics,b);c.publishTopic(d,a.onalw,b)}};a.language=a.editorLocal?a.editorLocal:c.local;a.resizable=!1;a.resize_enabled=!1;a.editorResizable&&(a.resize_enabled=!0);a.href&&"#"!==a.href?(d.isSubscribed(b)&&d.unsubscribe(b),d.subscribe(b,function(c,b){d.ckeditor(e,a)}),a.oncom=a.oncom&&""!==a.oncom?a.oncom+","+b:b,c.container(d,a)):(c.container(d,a),d.ckeditor(e,a));g=CKEDITOR.instances[a.id];
if(a.onblurtopics)g.on("blur",function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.onblurtopics,{editor:b});c.publishTopic(b,a.onalw,{editor:b})});if(a.onfocustopics)g.on("focus",function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.onfocustopics,{editor:b});c.publishTopic(b,a.onalw,{editor:b})});if(a.oncha)g.on("change",function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.oncha,{editor:b});c.publishTopic(b,a.onalw,{editor:b})})},tinymce:function(d,a){var c=
this,g="s2j_tinymce_"+a.id;c.log("tinymce for: "+a.id);c.require("js/tinymce/jquery.tinymce.min.js");debugger;window[tinymce]&&window[tinymce].editors[a.id]?window[tinymce].execCommand("mceRemoveEditor",!0,a.id):(a.resizable=!1,a.editorResizable&&(a.theme_advanced_resizing=!0),c.container(d,a),a.script_url=a.path+"tinymce.min.js",a.oncha&&(a.onchange_callback=function(b){if(tinyMCE.activeEditor.isDirty()){var e={};e.editor=b;e.content=b.getBody().innerHTML;c.publishTopic(d,a.oncha,e);c.publishTopic(d,
a.onalw,e)}}),a.onsavetopics&&(a.save_callback=function(b,e,g){var f={};f.editorid=b;f.html=e;f.body=g;c.publishTopic(d,a.onsavetopics,f);c.publishTopic(d,a.onalw,f);return f.html}),a.oneventtopics&&(a.handle_event_callback=function(b){var e={};e.event=b;e.returnvalue=!0;c.publishTopic(d,a.oneventtopics,e);c.publishTopic(d,a.onalw,e);return e.returnvalue}),a.setup=function(b){b.on("init",function(e){tinyMCE.execCommand("mceAddEditor",!0,a.id);b.getDoc();if(a.onblurtopics)b.on("blur",function(e){c.publishTopic(d,
a.onblurtopics,{editor:b});c.publishTopic(d,a.onalw,{editor:b})});if(a.onfocustopics)b.on("focus",function(e){c.publishTopic(d,a.onfocustopics,{editor:b});c.publishTopic(d,a.onalw,{editor:b})})});b.on("SaveContent",function(a){return!1});if(a.pasteplain)b.on("change",function(a){if(a.ctrlKey&&(118===a.charCode||86===a.keyCode))return b.execCommand("mcePasteText",!0),b.execCommand("mceAddUndoLevel"),tinymce.dom.Event.cancel(a)})},a.pasteplain&&(a.paste_text_sticky=!0,a.paste_text_use_dialog=!0),a.language=
a.editorLocal?a.editorLocal:c.local,a.href&&"#"!==a.href?(d.isSubscribed(g)&&d.unsubscribe(g),d.subscribe(g,function(b,c){d.tinymce(a)}),a.oncom=g,c.container(d,a)):(c.container(d,a),d.tinymce(a)))}};f.extend(!0,f.struts2_jquery_richtext,f.struts2_jquery);f.struts2_jquery_richtext.debugPrefix="[struts2_jquery_richtext] "})(jQuery);