/*

 jquery.richtext.struts2.js

 Integration of richtext editor with struts 2

 Requires use of jquery.struts2.js

 Copyright (c) 2010 - 2015 Johannes Geppert http://www.jgeppert.com

 Dual licensed under the MIT and GPL licenses:
   http://www.opensource.org/licenses/mit-license.php
   http://www.gnu.org/licenses/gpl.html

*/
'use strict';(function(f){f.struts2_jquery_richtext={editors:[],editorsTinymce:[],ckeditorTimer:void 0,clean:function(d){var a=this;window.CKEDITOR&&f.each(a.editors,function(c,g){var e=CKEDITOR.instances[g];0!==d.length&&e&&e.textarea===d[0]||(a.editors.splice(c),delete CKEDITOR.instances[g])})},ckeditor:function(d,a){var c=this,g,e="s2j_ckeditor_"+a.id,b;c.log("ckeditor for : "+a.id);c.require("js/ckeditor/ckeditor.js");c.require("js/ckeditor/adapters/jquery.js");(g=CKEDITOR.instances[a.id])&&CKEDITOR.remove(g);
c.clean(d);b=function(){c.editors[c.editors.length]=a.id;if(a.onEditorReadyTopics){var b={};c.publishTopic(d,a.onEditorReadyTopics,b);c.publishTopic(d,a.onalw,b)}};a.language=a.editorLocal?a.editorLocal:c.local;a.resizable=!1;a.resize_enabled=a.editorResizable?!0:!1;a.href&&"#"!==a.href?(d.isSubscribed(e)&&d.unsubscribe(e),d.subscribe(e,function(c,e){d.ckeditor(b,a)}),a.oncom=a.oncom&&""!==a.oncom?a.oncom+","+e:e,c.container(d,a)):(c.container(d,a),d.ckeditor(b,a));g=CKEDITOR.instances[a.id];if(a.onblurtopics)g.on("blur",
function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.onblurtopics,{editor:b});c.publishTopic(b,a.onalw,{editor:b})});if(a.onfocustopics)g.on("focus",function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.onfocustopics,{editor:b});c.publishTopic(b,a.onalw,{editor:b})});if(a.oncha)g.on("change",function(b){b=f(c.escId(b.editor.element.$.id));c.publishTopic(b,a.oncha,{editor:b});c.publishTopic(b,a.onalw,{editor:b})})},tinymce:function(d,a){var c=this,g="s2j_tinymce_"+a.id;c.log("tinymce for : "+
a.id);c.require("js/tinymce/jquery.tinymce.js");a.resizable=!1;a.editorResizable&&(a.theme_advanced_resizing=!0);c.container(d,a);a.script_url=a.path+"tiny_mce.js";a.oncha&&(a.onchange_callback=function(e){if(tinyMCE.activeEditor.isDirty()){var b={};b.editor=e;b.content=e.getBody().innerHTML;c.publishTopic(d,a.oncha,b);c.publishTopic(d,a.onalw,b)}});a.onsavetopics&&(a.save_callback=function(e,b,g){var f={};f.editorid=e;f.html=b;f.body=g;c.publishTopic(d,a.onsavetopics,f);c.publishTopic(d,a.onalw,
f);return f.html});a.oneventtopics&&(a.handle_event_callback=function(e){var b={};b.event=e;b.returnvalue=!0;c.publishTopic(d,a.oneventtopics,b);c.publishTopic(d,a.onalw,b);return b.returnvalue});a.setup=function(e){e.onInit.add(function(b){tinyMCE.execCommand("mceRepaint");b.getDoc();a.onblurtopics&&tinymce.dom.Event.add(b.settings.content_editable?b.getBody():tinymce.isGecko?b.getDoc():b.getWin(),"blur",function(e){c.publishTopic(d,a.onblurtopics,{editor:b});c.publishTopic(d,a.onalw,{editor:b})});
a.onfocustopics&&tinymce.dom.Event.add(b.settings.content_editable?b.getBody():tinymce.isGecko?b.getDoc():b.getWin(),"focus",function(e){c.publishTopic(d,a.onfocustopics,{editor:b});c.publishTopic(d,a.onalw,{editor:b})})});e.onSaveContent.add(function(a,c){return!1});a.pasteplain&&e.onKeyDown.add(function(a,c){if(c.ctrlKey&&(118===c.charCode||86===c.keyCode))return a.execCommand("mcePasteText",!0),a.execCommand("mceAddUndoLevel"),tinymce.dom.Event.cancel(c)})};a.pasteplain&&(a.paste_text_sticky=!0,
a.paste_text_use_dialog=!0);a.language=a.editorLocal?a.editorLocal:c.local;a.href&&"#"!==a.href?(d.isSubscribed(g)&&d.unsubscribe(g),d.subscribe(g,function(c,b){d.tinymce(a)}),a.oncom=g,c.container(d,a)):(c.container(d,a),d.tinymce(a))}};f.extend(!0,f.struts2_jquery_richtext,f.struts2_jquery);f.struts2_jquery_richtext.debugPrefix="[struts2_jquery_richtext] "})(jQuery);