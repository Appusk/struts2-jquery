/*!
 * jquery.struts2.js
 *
 * Integration of jquery and jquery ui with struts 2
 * for ajax, widget and interactions support in struts 2
 *
 * Requires use of jQuery.
 * Tested with jQuery 2.1 and jQuery UI 1.11
 *
 * Copyright (c) 2008 Eric Chijioke (obinna a-t g mail dot c o m)
 * Copyright (c) 2012 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
!function(e,t){"use strict";e.struts2_jquery={debug:!1,debugPrefix:"[struts2_jquery] ",ajaxhistory:!1,loadAtOnce:!1,local:"en",gridLocal:"en",timeLocal:"en",minSuffix:".min",historyelements:{},forms:{},scriptCache:{},styleCache:{},defaults:{indicator:"",loadingText:null,errorText:null},handler:{load:"_s2j_container_load",form:"_s2j_form_submit",effect:"_s2j_effects"},currentXhr:{},log:function(e){if(this.debug){var t=this.debugPrefix+e;window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}},escId:function(e){return"#"+e.replace(/(:|\.)/g,"\\$1")},addParam:function(e,t){return e.indexOf("?")>0?e+"&"+t:e+"?"+t},changeParam:function(e,t,i){var s,o=e.split("?"),a=o[1].split("&"),r=[];for(s=0;s<a.length;s++)r=a[s].split("="),r[0]===t&&(a[s]=r[0]+"="+i);return o[0]+"?"+a.join("&")},require:function(t,i,s){var o,a,r=this;o=i||function(){},a=s||null,null!==a||e.scriptPath?null===a&&e.scriptPath&&(a=e.scriptPath):a="","string"==typeof t&&(t=t.split(",")),e.each(t,function(t,i){i=r.addParam(i,"s2j="+e.struts2_jquery.version),e.struts2_jquery.scriptCache[i]||(r.log("load require script "+(a+i)),e.ajax({type:"GET",scriptCharset:"UTF-8",url:a+i,success:o,dataType:"script",cache:!0,async:!1}),e.struts2_jquery.scriptCache[i]=!0)})},requireCss:function(t,i){if(!this.styleCache[t]){var s,o;s=i||null,null!==s||e.scriptPath?null===s&&e.scriptPath&&(s=e.scriptPath):s="",this.log("load require css "+(s+t)),o=document.createElement("link"),o.setAttribute("rel","stylesheet"),o.setAttribute("type","text/css"),o.setAttribute("href",s+t),document.getElementsByTagName("head")[0].appendChild(o),this.styleCache[t]=!0}},hideIndicator:function(t){t&&e(this.escId(t)).hide(),""!==this.defaults.indicator&&e(this.escId(this.defaults.indicator)).hide()},showIndicator:function(t){t&&e(this.escId(t)).show(),""!==this.defaults.indicator&&e(this.escId(this.defaults.indicator)).show()},abortReq:function(e){var t=this.currentXhr[e];t&&null!==t&&t.readyState<4&&t.abort()},validateForm:function(i,s){var o=this,a=!0,r={};return o.loadAtOnce||o.require("js/plugins/jquery.form"+o.minSuffix+".js"),r.type="POST",r.data={"struts.enableJSONValidation":!0,"struts.validateOnly":!0},r.url=s.href&&"#"!==s.href?s.href:i[0].action,s.hrefparameter&&(r.url=r.url+"?"+s.hrefparameter),r.cache=!1,r.async=!1,r.complete=function(r){var n,c=e(i[0]),l=r.responseText;e.isFunction(s.validateFunction)?l&&l.length>10&&(a=!1,n=e.parseJSON("/*"===l.substring(0,2)?l.substring(2,l.length-2):l),s.validateFunction(c,n)):StrutsUtils!==t&&(StrutsUtils.clearValidationErrors(i[0]),n=StrutsUtils.getValidationErrors("/*"===l.substring(0,2)?l:e.parseJSON(l)),(n.fieldErrors||n.errors)&&(StrutsUtils.showValidationErrors(i[0],n),a=!1)),o.log("form validation : "+a)},i.ajaxSubmit(r),a},addForms:function(t,i){var s=this;return t&&(s.loadAtOnce||s.require("js/plugins/jquery.form"+s.minSuffix+".js"),e.each(t.split(","),function(t,o){var a=e(s.escId(o)).formSerialize();i=s.addParam(i,a)})),i},pubTops:function(e,t,i){var s=this;return i?function(o,a){var r={};r.event=o,r.ui=a,s.publishTopic(e,i,r),s.publishTopic(e,t,r)}:null},subscribeTopics:function(t,i,s,o){i&&t&&e.each(i.split(","),function(e,i){t.isSubscribed(i)&&t.destroyTopic(i),t.subscribe(i,s,o)})},publishTopic:function(t,i,s){var o=this;i&&e.each(i.split(","),function(e,i){o.log("publish topic : "+i),t.publish(i,t,s)})},pubSuc:function(i,s,o,a,r,n){var c,l,u=this,d=e(i),f=null,p=0,h=!1;return function(i,a,b){var m={};m.data=i,m.status=a,m.request=b,"html"!==r||e.isArray(i)||e.isPlainObject(i)?"value"===r?d.val(e.trim(i)):("select"===r||"radio"===r||"checkbox"===r)&&("select"===r?d[0].length=0:d.children().remove(),(e.isPlainObject(i)||e.isArray(i))&&(c=-1,"select"===r&&(n.headerkey&&n.headervalue&&(f=e('<option value="'+n.headerkey+'">'+n.headervalue+"</option>"),n.value===n.headervalue&&f.prop("selected",!0),f.appendTo(d)),n.emptyoption&&e("<option></option>").appendTo(d)),null!==i[n.list]&&(e.isArray(i[n.list])||(h=!0),e.each(i[n.list],function(s,o){var a={};("radio"===r||"checkbox"===r)&&(a.name=n.name),h?(a.text=o,a.value=s):n.listkey!==t&&n.listvalue!==t?(a.text=o[n.listvalue],a.value=o[n.listkey]):(a.text=i[n.list][p],a.value=i[n.list][p]),n.value!==t&&n.value==a.value&&(a.selected=!0),"select"===r?(f=e('<option value="'+a.value+'">'+a.text+"</option>"),a.selected&&f.prop("selected",!0),f.appendTo(d)):(l=++c,"radio"===r?f=e('<input name="'+a.name+'" type="radio" id="'+a.name+l+'" value="'+a.value+'"></input>'):"checkbox"===r&&(f=e('<input name="'+a.name+'" type="checkbox" id="'+a.name+l+'" value="'+a.value+'"></input>')),a.selected&&f.prop("checked",!0),d.append(f),d.append(e('<label id="'+a.name+l+'label" for="'+a.name+l+'">'+a.text+"</label>"))),p++})))):d.html(i),o&&(u.publishTopic(d,o,m),u.publishTopic(d,s,m))}},pubCom:function(t,i,s,o,a,r){var n=this,c=e.struts2_jquery_ui,l=e(t);return function(t,u){var d={};d.request=t,d.status=u,n.hideIndicator(a),n.publishTopic(l,s,d),n.publishTopic(l,i,d),o||(o=r.id),o&&e.each(o.split(","),function(t,i){var s=e(n.escId(i));s.publish("_sj_div_effect_"+i+r.id,r)}),c&&r.resizable&&c.resizable(l,r)}},pubErr:function(t,i,s,o,a){var r=this,n=e(t);return s||o?function(e,t,c){var l={};l.request=e,l.status=t,l.error=c,("html"===a||"value"===a)&&(o&&"false"!==o?n.html(o):null!==r.defaults.errorText&&n.html(r.defaults.errorText)),r.publishTopic(n,s,l),r.publishTopic(n,i,l)}:null},preBind:null,postBind:null,bind:function(t,i){var s,o,a=this;return t&&(s=e(t),t=s[0],o=t.tagName.toLowerCase(),i.tagname=o,("function"!=typeof a.preBind||a.preBind(s))&&(i.jqueryaction||(i.jqueryaction=o),a.log("bind "+i.jqueryaction+" on "+i.id),a[i.jqueryaction](s,i),a.postBind&&"function"==typeof a.postBind))?a.postBind(t):void 0},jqueryaction:function(e,t){var i=this;e&&t&&(i[e]=t)},history:function(t,i,s){var o=this,a={};a.target=s,a.topic=i,t.bind("click",a,function(t){return o.historyelements[t.data.target]=t.data.topic,o.lasttopic=i,e.bbq.pushState(o.historyelements),!1}),e(window).bind("hashchange",a,function(t){var i=t.getState(t.data.target)||"";e.each(t.fragment.split("&"),function(s,a){var r=a.split("=");o.historyelements[r[0]]!==r[1]&&r[1]!==o.lasttopic&&(o.lasttopic=i,e.publish(r[1],t.data.options))})})},action:function(t,i,s,o){var a=this,r="_sj_action_"+i.id,n=i.href,c={};i.actionTopic=r,(null===n||""===n)&&(n="#",i.href=n),c.effect=i.effect,c.effectoptions=i.effectoptions,c.effectmode=i.effectmode,c.oneffect=i.oneffect,c.effectduration=i.effectduration,i.datatype&&!i.targets&&"json"===i.datatype&&(i.targets="false"),i.targets?e.each(i.targets.split(","),function(o,n){c.targets=n;var l=e(a.escId(n));0===l.length&&(l=t),a.subscribeTopics(l,r+n,s,i),a.subscribeTopics(l,"_sj_div_effect_"+n+i.id,a.handler.effect,c),a.ajaxhistory&&a.history(t,r+n,n)}):(c.targets=i.id,a.subscribeTopics(e(a.escId(i.id)),"_sj_div_effect_"+i.id+i.id,a.handler.effect,c),(i.onbef||i.oncom||i.onsuc||i.onerr)&&a.subscribeTopics(t,r,s,i)),"a"===o&&t.click(function(){return i.targets&&e.each(i.targets.split(","),function(e,i){t.publish(r+i)}),i.preventAction?!1:void 0})},container:function(t,i){var s=this,o="_s2j_div_load_"+i.id,a="_s2j_div_effect_"+i.id,r=e.struts2_jquery_ui,n={},c=t,l="click";s.log("container : "+i.id),s.action(t,i,s.handler.load,"div"),i.formids&&!i.type||i.href&&"#"!==i.href?("#"!==i.href?(s.subscribeTopics(t,i.reloadtopics,s.handler.load,i),s.subscribeTopics(t,i.listentopics,s.handler.load,i),s.subscribeTopics(t,o,s.handler.load,i),i.bindon&&(i.events?e.each(i.events.split(","),function(t,s){e("#"+i.bindon).publishOnEvent(s,o,i)}):e("#"+i.bindon).publishOnEvent("click",o,i))):i.formids&&(s.loadAtOnce||s.require("js/plugins/jquery.form"+s.minSuffix+".js"),i.targets=i.id,s.formsubmit(t,i,o)),i.deferredloading||(i.delay?setTimeout(function(){t.publish(o,i)},i.delay):t.publish(o,i)),i.updatefreq&&(i.delay?setTimeout(function(){setInterval(function(){t.publish(o,i)},i.updatefreq)},i.delay):setInterval(function(){t.publish(o,i)},i.updatefreq))):(i.id&&i.effect&&(n.targets=i.id,n.effect=i.effect,n.effectoptions=i.effectoptions,n.effectduration=i.effectduration,s.subscribeTopics(t,a+i.id+i.id,s.handler.effect,n)),i.events||i.bindon?(i.bindon&&(c=e(s.escId(i.bindon))),i.events&&(l=i.events),e.each(l.split(","),function(t,s){i.onbef&&e.each(i.onbef.split(","),function(e,t){c.publishOnEvent(s,t)}),c.publishOnEvent(s,a+i.id+i.id,i),i.oncom&&e.each(i.oncom.split(","),function(e,t){c.publishOnEvent(s,t)})})):(i.onbef&&e.each(i.onbef.split(","),function(e,s){t.publish(s,i)}),t.publish(a+i.id+i.id,i),i.oncom&&e.each(i.oncom.split(","),function(e,s){t.publish(s,i)})),r&&i.resizable&&r.resizable(t,i)),r&&i.draggable&&r.draggable(t,i),r&&i.droppable&&r.droppable(t,i),r&&i.selectable&&r.selectable(t,i),r&&i.sortable&&r.sortable(t,i),i.onblurtopics&&e.each(i.onblurtopics.split(","),function(e,i){t.blur(function(){s.publishTopic(t,i,{})})}),i.onfocustopics&&e.each(i.onfocustopics.split(","),function(e,i){t.focus(function(){s.publishTopic(t,i,{})})}),i.oncha&&i.type&&("text"===i.type?t.keyup(function(){s.publishTopic(t,i.oncha,{})}):"select"===i.type&&(t.change(function(){s.publishTopic(t,i.oncha,{})}),t.select(function(){s.publishTopic(t,i.onselecttopics,{})})))},anchor:function(t,i){var s=this,o="_s2j_form_topic_"+i.id;s.log("anchor : "+i.id),i.onclick&&e.each(i.onclick.split(","),function(e,s){t.publishOnEvent("click",s,i)}),i.opendialog&&e.struts2_jquery_ui.opendialog(t,i),i.button&&e.struts2_jquery_ui.jquerybutton(t,i),i.href&&"#"!==i.href||!i.formids?(s.action(t,i,s.handler.load,"a"),i.targets&&(i.reloadtopic||i.listentopics)&&e.each(i.targets.split(","),function(t,o){var a=e(s.escId(o));s.subscribeTopics(a,i.reloadtopics,s.handler.load,i),s.subscribeTopics(a,i.listentopics,s.handler.load,i)})):s.formsubmit(t,i,o)},select:function(t,i){var s=this,o="_s2j_topic_load_"+i.id;s.log("select : "+i.id),s.loadAtOnce||s.require("js/plugins/jquery.form"+s.minSuffix+".js"),i.href&&"#"!==i.href&&(s.subscribeTopics(t,i.reloadtopics,s.handler.load,i),s.subscribeTopics(t,i.listentopics,s.handler.load,i),s.subscribeTopics(t,o,s.handler.load,i),i.deferredloading||t.publish(o,i)),i.oncha&&e.each(i.oncha.split(","),function(e,i){t.publishOnEvent("change",i)}),i.autocomplete&&(s.loadAtOnce||s.require(["js/base/widget"+s.minSuffix+".js","js/base/position"+s.minSuffix+".js","js/base/menu"+s.minSuffix+".js","js/base/button"+s.minSuffix+".js","js/base/autocomplete"+s.minSuffix+".js"]),s.requireCss("themes/s2j-combobox.css"),s.require(["js/plugins/jquery.combobox"+s.minSuffix+".js"]),t.combobox(i))},button:function(i,s){var o,a,r,n,c=this,l="_s2j_form_topic_"+s.id;s.preventAction=!0,s.opendialog&&e.struts2_jquery_ui.opendialog(i,s),s.button&&e.struts2_jquery_ui.jquerybutton(i,s),s.href&&"#"!==s.href&&s.formids===t?s.href&&"#"!==s.href?(c.action(i,s,c.handler.load,"a"),s.targets&&e.each(s.targets.split(","),function(t,i){c.subscribeTopics(e(c.escId(i)),s.reloadtopics,c.handler.load,s),c.subscribeTopics(e(c.escId(i)),s.listentopics,c.handler.load,s)})):(o=i.parents("form:first")[0],o!==t?(a=e(o),r=a.attr("id"),r!==t?s.formids=r:(n="s2jqform"+Math.floor(1e4*Math.random()),a.attr("id",n),s.formids=n),c.formsubmit(i,s,l)):(c.action(i,s,c.handler.load,"a"),s.targets&&e.each(s.targets.split(","),function(t,i){c.subscribeTopics(e(c.escId(i)),s.reloadtopics,c.handler.load,s),c.subscribeTopics(e(c.escId(i)),s.listentopics,c.handler.load,s)}))):c.formsubmit(i,s,l),s.onclick&&e.each(s.onclick.split(","),function(e,t){i.publishOnEvent("click",t)}),i.removeAttr("name")},formsubmit:function(t,i,s){var o=this,a={};i.actionTopic=s,o.log("formsubmit : "+i.id),o.loadAtOnce||o.require("js/plugins/jquery.form"+o.minSuffix+".js"),i.targets?(o.subscribeTopics(t,i.reloadtopics,o.handler.form,i),o.subscribeTopics(t,i.listentopics,o.handler.form,i),o.subscribeTopics(t,s,o.handler.form,i),e.each(i.targets.split(","),function(a,r){o.subscribeTopics(e(o.escId(r)),"_sj_div_effect_"+r+i.id,o.handler.effect,i),o.ajaxhistory&&o.history(t,s,r)}),e.each(i.formids.split(","),function(t,i){e(o.escId(i)).bind("submit",function(e){e.preventDefault()})}),t.click(function(){return t.publish(s),!1})):(t.click(function(s){var a=e(o.escId(i.formids)),r={};return r.formvalidate=!0,s.preventDefault(),i.validate&&(r.formvalidate=o.validateForm(a,i),i.onaftervalidation&&e.each(i.onaftervalidation.split(","),function(e,i){t.publish(i,t,r)})),r.formvalidate&&(i.href&&"#"!=i.href&&(a[0].action=i.href),a.submit()),!1}),i.listentopics&&(a.formids=i.formids,a.validate=i.validate,t.subscribe(i.listentopics,function(s){var a=e(o.escId(s.data.formids)),r={formvalidate:!0};s.data.validate&&(r.formvalidate=o.validateForm(a,i),i.onaftervalidation&&e.each(i.onaftervalidation.split(","),function(e,i){t.publish(i,t,r)})),r.formvalidate&&(i.href&&"#"!=i.href&&(a[0].action=i.href),a.submit())},a)))}},e.subscribeHandler(e.struts2_jquery.handler.load,function(t,i){var s,o,a,r=e.struts2_jquery,n=e(t.target),c={},l=!1,u="html",d={};i&&e.extend(c,i),t.data&&e.extend(c,t.data),r.lasttopic=c.actionTopic,o=c.indicatorid,a=c.onalw,l=null===c.disabled?l:c.disabled,l=n.prop("disabled"),t.originalEvent&&(l=e(t.originalEvent.currentTarget).prop("disabled")),l!==!0&&c&&(r.showIndicator(o),c.type&&("text"===c.type?u="value":"select"===c.type?u="select":"checkbox"===c.type?u="checkbox":"radio"===c.type&&(u="radio")),("html"===u||"value"===u)&&(c.datatype&&"json"===c.datatype||(c.loadingtext&&"false"!==c.loadingtext?"html"===u?n.html(c.loadingtext):n.val(c.loadingtext):null!==r.defaults.loadingText&&("html"===u?n.html(r.defaults.loadingText):n.val(r.defaults.loadingText)))),d.success=r.pubSuc(t.target,a,c.onsuc,o,u,c),d.complete=r.pubCom(t.target,a,c.oncom,c.targets,o,c),d.error=r.pubErr(t.target,a,c.onerr,c.errortext,u),c.href&&(d.url=c.href,d.data="",c.hrefparameter&&(d.data=c.hrefparameter),d.type=c.requesttype?c.requesttype:"POST",c.formids&&(r.loadAtOnce||r.require("js/plugins/jquery.form"+r.minSuffix+".js"),e.each(c.formids.split(","),function(t,i){var s=e(r.escId(i)).formSerialize();d.data=""!==d.data?d.data+"&"+s:s})),d.dataType=c.datatype?c.datatype:"html",d.data||(d.data={}),c.options=d,c.options.submit=!0,r.publishTopic(n,a,c),r.publishTopic(n,c.onbef,c),c.options.submit&&(s=n.attr("id"),r.abortReq(n.attr("id")),r.currentXhr[s]=e.ajax(d))))}),e.subscribeHandler(e.struts2_jquery.handler.form,function(t,i){var s,o,a=e.struts2_jquery,r=e(t.target),n={},c={};return i&&e.extend(n,i),t.data&&e.extend(n,t.data),a.lasttopic=n.actionTopic,s=n.indicatorid,o=n.onalw,n.href&&"#"!==n.href&&(c.url=n.href,n.hrefparameter&&(c.url=c.url+"?"+n.hrefparameter)),n.clearform&&(c.clearForm=!0),n.iframe&&(c.iframe=!0),n.resetform&&(c.resetForm=!0),n.replaceTarget&&(c.replaceTarget=!0),n.timeout&&(c.timeout=parseInt(n.timeout,10)),c.dataType=n.datatype?n.datatype:null,c.target="",n.targets&&e.each(n.targets.split(","),function(t,i){r=e(a.escId(i)),c.target=""===c.target?a.escId(i):c.target+",#"+a.escId(i)}),c.beforeSubmit=function(t,i,c){var l={};return l.formData=t,l.form=i,l.options=c,l.options.submit=!0,a.publishTopic(r,o,l),n.onbef&&e.each(n.onbef.split(","),function(e,t){r.publish(t,r,l)}),n.validate&&l.options.submit&&(l.options.submit=a.validateForm(i,n),l.formvalidate=l.options.submit,n.onaftervalidation&&e.each(n.onaftervalidation.split(","),function(e,t){r.publish(t,r,l)})),l.options.submit&&(a.showIndicator(s),n.datatype&&"json"===n.datatype||(n.loadingtext&&"false"!==n.loadingtext?e.each(n.targets.split(","),function(t,i){e(a.escId(i)).html(n.loadingtext)}):null!==a.defaults.loadingText&&e.each(n.targets.split(","),function(t,i){e(a.escId(i)).html(a.defaults.loadingText)}))),l.options.submit},c.success=a.pubSuc(r,o,n.onsuc,s,"form",n),c.complete=a.pubCom(r,o,n.oncom,n.targets,s,n),c.error=a.pubErr(r,o,n.onerr,n.errortext,"html"),e.each(n.formids.split(","),function(t,i){a.log("submit form : "+i),e(a.escId(i)).ajaxSubmit(c)}),!1}),e.subscribeHandler(e.struts2_jquery.handler.effect,function(t){var i=e.struts2_jquery,s={},o={},a=2e3,r=null,n=null;e.extend(s,t.data),s.targets&&s.effect&&(s.effectoptions&&(o=s.effectoptions),s.effectduration&&(a=s.effectduration),s.oneffect&&(e.each(s.targets.split(","),function(t,o){e.subscribe(e(i.escId(o)),s.oneffect,s)}),r=function(){e.each(s.targets.split(","),function(t,o){i.publishTopic(e(i.escId(o)),s.oneffect,s)})}),i.loadAtOnce||i.require(["js/base/effect"+i.minSuffix+".js","js/base/effect-"+s.effect+i.minSuffix+".js"]),i.log("effect "+s.effect+" for "+s.targets),e.each(s.targets.split(","),function(t,c){n=e(i.escId(c)),s.effectmode&&"none"!==s.effectmode?"show"===s.effectmode?n.show(s.effect,o,a,r):"hide"===s.effectmode?n.hide(s.effect,o,a,r):"toggle"===s.effectmode&&n.toggle(s.effect,o,a,r):n.effect(s.effect,o,a,r)}))})}(jQuery);