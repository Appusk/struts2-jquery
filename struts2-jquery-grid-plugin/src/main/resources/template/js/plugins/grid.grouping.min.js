'use strict';(function(d){d.extend(d.jgrid,{template:function(b){var m=d.makeArray(arguments).slice(1),a,c=m.length;null==b&&(b="");return b.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(b,h){if(!isNaN(parseInt(h,10)))return m[parseInt(h,10)];for(a=0;a<c;a++)if(d.isArray(m[a]))for(var k=m[a],e=k.length;e--;)if(h===k[e].nm)return k[e].v})}});d.jgrid.extend({groupingSetup:function(){return this.each(function(){var b,m,a=this.p.colModel,c=this.p.groupingView;if(null===c||"object"!==
typeof c&&!d.isFunction(c))this.p.grouping=!1;else if(c.groupField.length){void 0===c.visibiltyOnNextGrouping&&(c.visibiltyOnNextGrouping=[]);c.lastvalues=[];c._locgr||(c.groups=[]);c.counters=[];for(b=0;b<c.groupField.length;b++)c.groupOrder[b]||(c.groupOrder[b]="asc"),c.groupText[b]||(c.groupText[b]="{0}"),"boolean"!==typeof c.groupColumnShow[b]&&(c.groupColumnShow[b]=!0),"boolean"!==typeof c.groupSummary[b]&&(c.groupSummary[b]=!1),c.groupSummaryPos[b]||(c.groupSummaryPos[b]="footer"),!0===c.groupColumnShow[b]?
(c.visibiltyOnNextGrouping[b]=!0,d(this).jqGrid("showCol",c.groupField[b])):(c.visibiltyOnNextGrouping[b]=d("#"+d.jgrid.jqID(this.p.id+"_"+c.groupField[b])).is(":visible"),d(this).jqGrid("hideCol",c.groupField[b]));c.summary=[];c.hideFirstGroupCol&&(c.formatDisplayField[0]=function(a){return a});b=0;for(m=a.length;b<m;b++)c.hideFirstGroupCol&&!a[b].hidden&&c.groupField[0]===a[b].name&&(a[b].formatter=function(){return""}),a[b].summaryType&&(a[b].summaryDivider?c.summary.push({nm:a[b].name,st:a[b].summaryType,
v:"",sd:a[b].summaryDivider,vd:"",sr:a[b].summaryRound,srt:a[b].summaryRoundType||"round"}):c.summary.push({nm:a[b].name,st:a[b].summaryType,v:"",sr:a[b].summaryRound,srt:a[b].summaryRoundType||"round"}))}else this.p.grouping=!1})},groupingPrepare:function(b,m){this.each(function(){var a=this.p.groupingView,c=this,g,h=a.groupField.length,k,e,f,p=0;for(g=0;g<h;g++)k=a.groupField[g],f=a.displayField[g],e=b[k],f=null==f?null:b[f],null==f&&(f=e),void 0!==e&&(0===m?(a.groups.push({idx:g,dataIndex:k,value:e,
displayValue:f,startRow:m,cnt:1,summary:[]}),a.lastvalues[g]=e,a.counters[g]={cnt:1,pos:a.groups.length-1,summary:d.extend(!0,[],a.summary)}):"object"===typeof e||(d.isArray(a.isInTheSameGroup)&&d.isFunction(a.isInTheSameGroup[g])?a.isInTheSameGroup[g].call(c,a.lastvalues[g],e,g,a):a.lastvalues[g]===e)?1===p?(a.groups.push({idx:g,dataIndex:k,value:e,displayValue:f,startRow:m,cnt:1,summary:[]}),a.lastvalues[g]=e,a.counters[g]={cnt:1,pos:a.groups.length-1,summary:d.extend(!0,[],a.summary)}):(a.counters[g].cnt+=
1,a.groups[a.counters[g].pos].cnt=a.counters[g].cnt):(a.groups.push({idx:g,dataIndex:k,value:e,displayValue:f,startRow:m,cnt:1,summary:[]}),a.lastvalues[g]=e,p=1,a.counters[g]={cnt:1,pos:a.groups.length-1,summary:d.extend(!0,[],a.summary)}),d.each(a.counters[g].summary,function(){d.isFunction(this.st)?this.v=this.st.call(c,this.v,this.nm,b):(this.v=d(c).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,b),"avg"===this.st.toLowerCase()&&this.sd&&(this.vd=d(c).jqGrid("groupingCalculations.handler",
this.st,this.vd,this.sd,this.sr,this.srt,b)))}),a.groups[a.counters[g].pos].summary=a.counters[g].summary)});return this},groupingToggle:function(b){this.each(function(){var m=this.p.groupingView,a=b.split("_"),c=parseInt(a[a.length-2],10);a.splice(a.length-2,2);var g=a.join("_"),a=m.minusicon,m=m.plusicon,h=d("#"+d.jgrid.jqID(b)),h=h.length?h[0].nextSibling:null,k=d("#"+d.jgrid.jqID(b)+" span.tree-wrap-"+this.p.direction),e=function(a){a=d.map(a.split(" "),function(a){if(a.substring(0,g.length+1)===
g+"_")return parseInt(a.substring(g.length+1),10)});return 0<a.length?a[0]:void 0},f,p,r=!1,q=this.p.frozenColumns?this.p.id+"_frozen":!1,n=(f=q?d("#"+d.jgrid.jqID(b),"#"+d.jgrid.jqID(q)):!1)&&f.length?f[0].nextSibling:null;if(k.hasClass(a)){if(h)for(;h;){f=e(h.className);if(void 0!==f&&f<=c)break;d(h).hide();h=h.nextSibling;q&&(d(n).hide(),n=n.nextSibling)}k.removeClass(a).addClass(m);r=!0}else{if(h)for(p=void 0;h;){f=e(h.className);void 0===p&&(p=void 0===f);if(void 0!==f){if(f<=c)break;f===c+1&&
(d(h).show().find("\x3etd\x3espan.tree-wrap-"+this.p.direction).removeClass(a).addClass(m),q&&d(n).show().find("\x3etd\x3espan.tree-wrap-"+this.p.direction).removeClass(a).addClass(m))}else p&&(d(h).show(),q&&d(n).show());h=h.nextSibling;q&&(n=n.nextSibling)}k.removeClass(m).addClass(a)}d(this).triggerHandler("jqGridGroupingClickGroup",[b,r]);d.isFunction(this.p.onClickGroup)&&this.p.onClickGroup.call(this,b,r)});return!1},groupingRender:function(b,m,a,c){return this.each(function(){function g(a,
b,c){var d=!1;if(0===b)d=c[a];else{var e=c[a].idx;if(0===e)d=c[a];else for(;0<=a;a--)if(c[a].idx===e-b){d=c[a];break}}return d}function h(a,b,c,e){var f=g(a,b,c),h=k.p.colModel,p,q=f.cnt;a="";var n;for(n=e;n<m;n++){var r="\x3ctd "+k.formatCol(n,1,"")+"\x3e\x26#160;\x3c/td\x3e",t="{0}";d.each(f.summary,function(){if(this.nm===h[n].name){h[n].summaryTpl&&(t=h[n].summaryTpl);"string"===typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?this.v/=this.vd:this.v&&0<q&&(this.v/=q));try{this.groupCount=
f.cnt,this.groupIndex=f.dataIndex,this.groupValue=f.value,p=k.formatter("",this.v,n,this)}catch(a){p=this.v}r="\x3ctd "+k.formatCol(n,1,"")+"\x3e"+d.jgrid.format(t,p)+"\x3c/td\x3e";return!1}});a+=r}return a}var k=this,e=k.p.groupingView,f="",p="",r,q,n=e.groupCollapse?e.plusicon:e.minusicon,t,z=[],A=e.groupField.length,n=n+(" tree-wrap-"+k.p.direction);d.each(k.p.colModel,function(a,b){var c;for(c=0;c<A;c++)if(e.groupField[c]===b.name){z[c]=a;break}});var x=0,B=d.makeArray(e.groupSummary),y;B.reverse();
y=k.p.multiselect?' colspan\x3d"2"':"";d.each(e.groups,function(g,l){if(e._locgr&&!(l.startRow+l.cnt>(a-1)*c&&l.startRow<a*c))return!0;x++;q=k.p.id+"ghead_"+l.idx;r=q+"_"+g;p="\x3cspan style\x3d'cursor:pointer;' class\x3d'ui-icon "+n+"' onclick\x3d\"jQuery('#"+d.jgrid.jqID(k.p.id)+"').jqGrid('groupingToggle','"+r+"');return false;\"\x3e\x3c/span\x3e";try{d.isArray(e.formatDisplayField)&&d.isFunction(e.formatDisplayField[l.idx])?(l.displayValue=e.formatDisplayField[l.idx].call(k,l.displayValue,l.value,
k.p.colModel[z[l.idx]],l.idx,e),t=l.displayValue):t=k.formatter(r,l.displayValue,z[l.idx],l.value)}catch(D){t=l.displayValue}"header"===e.groupSummaryPos[l.idx]?(f+='\x3ctr id\x3d"'+r+'"'+(e.groupCollapse&&0<l.idx?' style\x3d"display:none;" ':" ")+'role\x3d"row" class\x3d "ui-widget-content jqgroup ui-row-'+k.p.direction+" "+q+'"\x3e\x3ctd style\x3d"padding-left:'+12*l.idx+'px;"'+y+"\x3e"+p+d.jgrid.template(e.groupText[l.idx],t,l.cnt,l.summary)+"\x3c/td\x3e",f+=h(g,0,e.groups,!1===e.groupColumnShow[l.idx]?
""===y?2:3:""===y?1:2),f+="\x3c/tr\x3e"):f+='\x3ctr id\x3d"'+r+'"'+(e.groupCollapse&&0<l.idx?' style\x3d"display:none;" ':" ")+'role\x3d"row" class\x3d "ui-widget-content jqgroup ui-row-'+k.p.direction+" "+q+'"\x3e\x3ctd style\x3d"padding-left:'+12*l.idx+'px;" colspan\x3d"'+(!1===e.groupColumnShow[l.idx]?m-1:m)+'"\x3e'+p+d.jgrid.template(e.groupText[l.idx],t,l.cnt,l.summary)+"\x3c/td\x3e\x3c/tr\x3e";if(A-1===l.idx){var s=e.groups[g+1],v,u=0;v=l.startRow;var C=void 0!==s?s.startRow:e.groups[g].startRow+
e.groups[g].cnt;e._locgr&&(u=(a-1)*c,u>l.startRow&&(v=u));for(;v<C&&b[v-u];v++)f+=b[v-u].join("");if("header"!==e.groupSummaryPos[l.idx]){var w;if(void 0!==s){for(w=0;w<e.groupField.length&&s.dataIndex!==e.groupField[w];w++);x=e.groupField.length-w}for(s=0;s<x;s++)B[s]&&(u="",e.groupCollapse&&!e.showSummaryOnHide&&(u=' style\x3d"display:none;"'),f+="\x3ctr"+u+' jqfootlevel\x3d"'+(l.idx-s)+'" role\x3d"row" class\x3d"ui-widget-content jqfoot ui-row-'+k.p.direction+'"\x3e',f+=h(g,s,e.groups,0),f+="\x3c/tr\x3e");
x=w}}});d("#"+d.jgrid.jqID(k.p.id)+" tbody:first").append(f);f=null})},groupingGroupBy:function(b,m){return this.each(function(){"string"===typeof b&&(b=[b]);var a=this.p.groupingView;this.p.grouping=!0;a._locgr=!1;void 0===a.visibiltyOnNextGrouping&&(a.visibiltyOnNextGrouping=[]);var c;for(c=0;c<a.groupField.length;c++)!a.groupColumnShow[c]&&a.visibiltyOnNextGrouping[c]&&d(this).jqGrid("showCol",a.groupField[c]);for(c=0;c<b.length;c++)a.visibiltyOnNextGrouping[c]=d("#"+d.jgrid.jqID(this.p.id)+"_"+
d.jgrid.jqID(b[c])).is(":visible");this.p.groupingView=d.extend(this.p.groupingView,m||{});a.groupField=b;d(this).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){void 0===b&&(b=!0);this.p.grouping=!1;if(!0===b){var m=this.p.groupingView,a;for(a=0;a<m.groupField.length;a++)!m.groupColumnShow[a]&&m.visibiltyOnNextGrouping[a]&&d(this).jqGrid("showCol",m.groupField);d("tr.jqgroup, tr.jqfoot","#"+d.jgrid.jqID(this.p.id)+" tbody:first").remove();d("tr.jqgrow:hidden","#"+
d.jgrid.jqID(this.p.id)+" tbody:first").show()}else d(this).trigger("reloadGrid")})},groupingCalculations:{handler:function(b,d,a,c,g,h){var k={sum:function(){return parseFloat(d||0)+parseFloat(h[a]||0)},min:function(){return""===d?parseFloat(h[a]||0):Math.min(parseFloat(d),parseFloat(h[a]||0))},max:function(){return""===d?parseFloat(h[a]||0):Math.max(parseFloat(d),parseFloat(h[a]||0))},count:function(){""===d&&(d=0);return h.hasOwnProperty(a)?d+1:0},avg:function(){return k.sum()}};if(!k[b])throw"jqGrid Grouping No such method: "+
b;b=k[b]();null!=c&&("fixed"===g?b=b.toFixed(c):(c=Math.pow(10,c),b=Math.round(b*c)/c));return b}}})})(jQuery);