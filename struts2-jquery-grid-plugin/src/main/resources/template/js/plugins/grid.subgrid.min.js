'use strict';(function(b){b.jgrid.extend({setSubGrid:function(){return this.each(function(){var d,c;this.p.subGridOptions=b.extend({plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:!1,delayOnLoad:50,selectOnExpand:!1,selectOnCollapse:!1,reloadOnExpand:!0},this.p.subGridOptions||{});this.p.colNames.unshift("");this.p.colModel.unshift({name:"subgrid",width:b.jgrid.cell_width?this.p.subGridWidth+this.p.cellLayout:this.p.subGridWidth,sortable:!1,resizable:!1,
hidedlg:!0,search:!1,fixed:!0});d=this.p.subGridModel;if(d[0])for(d[0].align=b.extend([],d[0].align||[]),c=0;c<d[0].name.length;c++)d[0].align[c]=d[0].align[c]||"left"})},addSubGridCell:function(b,c){var a="",p,q;this.each(function(){a=this.formatCol(b,c);q=this.p.id;p=this.p.subGridOptions.plusicon});return'\x3ctd role\x3d"gridcell" aria-describedby\x3d"'+q+'_subgrid" class\x3d"ui-sgcollapsed sgcollapsed" '+a+"\x3e\x3ca style\x3d'cursor:pointer;'\x3e\x3cspan class\x3d'ui-icon "+p+"'\x3e\x3c/span\x3e\x3c/a\x3e\x3c/td\x3e"},
addSubGrid:function(d,c){return this.each(function(){var a=this;if(a.grid){var p=function(c,d,h){d=b("\x3ctd align\x3d'"+a.p.subGridModel[0].align[h]+"'\x3e\x3c/td\x3e").html(d);b(c).append(d)},q=function(c,d){var h,f,e,g=b("\x3ctable cellspacing\x3d'0' cellpadding\x3d'0' border\x3d'0'\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e"),k=b("\x3ctr\x3e\x3c/tr\x3e");for(f=0;f<a.p.subGridModel[0].name.length;f++)h=b("\x3cth class\x3d'ui-state-default ui-th-subgrid ui-th-column ui-th-"+a.p.direction+"'\x3e\x3c/th\x3e"),
b(h).html(a.p.subGridModel[0].name[f]),b(h).width(a.p.subGridModel[0].width[f]),b(k).append(h);b(g).append(k);c&&(e=a.p.xmlReader.subgrid,b(e.root+" "+e.row,c).each(function(){k=b("\x3ctr class\x3d'ui-widget-content ui-subtblcell'\x3e\x3c/tr\x3e");if(!0===e.repeatitems)b(e.cell,this).each(function(a){p(k,b(this).text()||"\x26#160;",a)});else{var c=a.p.subGridModel[0].mapping||a.p.subGridModel[0].name;if(c)for(f=0;f<c.length;f++)p(k,b(c[f],this).text()||"\x26#160;",f)}b(g).append(k)}));h=b("table:first",
a.grid.bDiv).attr("id")+"_";b("#"+b.jgrid.jqID(h+d)).append(g);a.grid.hDiv.loading=!1;b("#load_"+b.jgrid.jqID(a.p.id)).hide();return!1},r=function(c,d){var h,f,e,g,k,m=b("\x3ctable cellspacing\x3d'0' cellpadding\x3d'0' border\x3d'0'\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e"),l=b("\x3ctr\x3e\x3c/tr\x3e");for(f=0;f<a.p.subGridModel[0].name.length;f++)h=b("\x3cth class\x3d'ui-state-default ui-th-subgrid ui-th-column ui-th-"+a.p.direction+"'\x3e\x3c/th\x3e"),b(h).html(a.p.subGridModel[0].name[f]),
b(h).width(a.p.subGridModel[0].width[f]),b(l).append(h);b(m).append(l);if(c&&(g=a.p.jsonReader.subgrid,h=b.jgrid.getAccessor(c,g.root),void 0!==h))for(f=0;f<h.length;f++){e=h[f];l=b("\x3ctr class\x3d'ui-widget-content ui-subtblcell'\x3e\x3c/tr\x3e");if(!0===g.repeatitems)for(g.cell&&(e=e[g.cell]),k=0;k<e.length;k++)p(l,e[k]||"\x26#160;",k);else{var n=a.p.subGridModel[0].mapping||a.p.subGridModel[0].name;if(n.length)for(k=0;k<n.length;k++)p(l,e[n[k]]||"\x26#160;",k)}b(m).append(l)}f=b("table:first",
a.grid.bDiv).attr("id")+"_";b("#"+b.jgrid.jqID(f+d)).append(m);a.grid.hDiv.loading=!1;b("#load_"+b.jgrid.jqID(a.p.id)).hide();return!1},v=function(c){var e,d,f,g;e=b(c).attr("id");d={nd_:(new Date).getTime()};d[a.p.prmNames.subgridid]=e;if(!a.p.subGridModel[0])return!1;if(a.p.subGridModel[0].params)for(g=0;g<a.p.subGridModel[0].params.length;g++)for(f=0;f<a.p.colModel.length;f++)a.p.colModel[f].name===a.p.subGridModel[0].params[g]&&(d[a.p.colModel[f].name]=b("td:eq("+f+")",c).text().replace(/\&#160\;/ig,
""));if(!a.grid.hDiv.loading)switch(a.grid.hDiv.loading=!0,b("#load_"+b.jgrid.jqID(a.p.id)).show(),a.p.subgridtype||(a.p.subgridtype=a.p.datatype),b.isFunction(a.p.subgridtype)?a.p.subgridtype.call(a,d):a.p.subgridtype=a.p.subgridtype.toLowerCase(),a.p.subgridtype){case "xml":case "json":b.ajax(b.extend({type:a.p.mtype,url:b.isFunction(a.p.subGridUrl)?a.p.subGridUrl.call(a,d):a.p.subGridUrl,dataType:a.p.subgridtype,data:b.isFunction(a.p.serializeSubGridData)?a.p.serializeSubGridData.call(a,d):d,complete:function(c){"xml"===
a.p.subgridtype?q(c.responseXML,e):r(b.jgrid.parse(c.responseText),e)}},b.jgrid.ajaxOptions,a.p.ajaxSubgridOptions||{}))}return!1},e,m,s,t=0,g,l;b.each(a.p.colModel,function(){!0!==this.hidden&&"rn"!==this.name&&"cb"!==this.name||t++});var u=a.rows.length,n=1;void 0!==c&&0<c&&(n=c,u=c+1);for(;n<u;)b(a.rows[n]).hasClass("jqgrow")&&(a.p.scroll&&b(a.rows[n].cells[d]).unbind("click"),b(a.rows[n].cells[d]).bind("click",function(){var c=b(this).parent("tr")[0];l=c.nextSibling;if(b(this).hasClass("sgcollapsed")){m=
a.p.id;e=c.id;if(!0===a.p.subGridOptions.reloadOnExpand||!1===a.p.subGridOptions.reloadOnExpand&&!b(l).hasClass("ui-subgrid")){s=1<=d?"\x3ctd colspan\x3d'"+d+"'\x3e\x26#160;\x3c/td\x3e":"";g=b(a).triggerHandler("jqGridSubGridBeforeExpand",[m+"_"+e,e]);(g=!1===g||"stop"===g?!1:!0)&&b.isFunction(a.p.subGridBeforeExpand)&&(g=a.p.subGridBeforeExpand.call(a,m+"_"+e,e));if(!1===g)return!1;b(c).after("\x3ctr role\x3d'row' class\x3d'ui-subgrid'\x3e"+s+"\x3ctd class\x3d'ui-widget-content subgrid-cell'\x3e\x3cspan class\x3d'ui-icon "+
a.p.subGridOptions.openicon+"'\x3e\x3c/span\x3e\x3c/td\x3e\x3ctd colspan\x3d'"+parseInt(a.p.colNames.length-1-t,10)+"' class\x3d'ui-widget-content subgrid-data'\x3e\x3cdiv id\x3d"+m+"_"+e+" class\x3d'tablediv'\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e");b(a).triggerHandler("jqGridSubGridRowExpanded",[m+"_"+e,e]);b.isFunction(a.p.subGridRowExpanded)?a.p.subGridRowExpanded.call(a,m+"_"+e,e):v(c)}else b(l).show();b(this).html("\x3ca style\x3d'cursor:pointer;'\x3e\x3cspan class\x3d'ui-icon "+a.p.subGridOptions.minusicon+
"'\x3e\x3c/span\x3e\x3c/a\x3e").removeClass("sgcollapsed").addClass("sgexpanded");a.p.subGridOptions.selectOnExpand&&b(a).jqGrid("setSelection",e)}else if(b(this).hasClass("sgexpanded")){g=b(a).triggerHandler("jqGridSubGridRowColapsed",[m+"_"+e,e]);g=!1===g||"stop"===g?!1:!0;e=c.id;g&&b.isFunction(a.p.subGridRowColapsed)&&(g=a.p.subGridRowColapsed.call(a,m+"_"+e,e));if(!1===g)return!1;!0===a.p.subGridOptions.reloadOnExpand?b(l).remove(".ui-subgrid"):b(l).hasClass("ui-subgrid")&&b(l).hide();b(this).html("\x3ca style\x3d'cursor:pointer;'\x3e\x3cspan class\x3d'ui-icon "+
a.p.subGridOptions.plusicon+"'\x3e\x3c/span\x3e\x3c/a\x3e").removeClass("sgexpanded").addClass("sgcollapsed");a.p.subGridOptions.selectOnCollapse&&b(a).jqGrid("setSelection",e)}return!1})),n++;!0===a.p.subGridOptions.expandOnLoad&&b(a.rows).filter(".jqgrow").each(function(a,c){b(c.cells[0]).click()});a.subGridXml=function(a,b){q(a,b)};a.subGridJson=function(a,b){r(a,b)}}})},expandSubGridRow:function(d){return this.each(function(){if((this.grid||d)&&!0===this.p.subGrid){var c=b(this).jqGrid("getInd",
d,!0);c&&(c=b("td.sgcollapsed",c)[0])&&b(c).trigger("click")}})},collapseSubGridRow:function(d){return this.each(function(){if((this.grid||d)&&!0===this.p.subGrid){var c=b(this).jqGrid("getInd",d,!0);c&&(c=b("td.sgexpanded",c)[0])&&b(c).trigger("click")}})},toggleSubGridRow:function(d){return this.each(function(){if((this.grid||d)&&!0===this.p.subGrid){var c=b(this).jqGrid("getInd",d,!0);if(c){var a=b("td.sgcollapsed",c)[0];a?b(a).trigger("click"):(a=b("td.sgexpanded",c)[0])&&b(a).trigger("click")}}})}})})(jQuery);