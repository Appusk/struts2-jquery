'use strict';(function(a){a.jgrid.extend({searchGrid:function(b){b=a.extend({recreateFilter:!1,drag:!0,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:!0,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:!1,closeAfterReset:!1,closeOnEscape:!1,multipleSearch:!1,cloneSearchRowOnAdd:!0,sopt:null,stringResult:void 0,onClose:null,useDataProxy:!1,overlay:!0},a.jgrid.search,b||{});return this.each(function(){function p(b,d){var c=
b.p.postData[d.sFilter];"string"==typeof c&&(c=a.jgrid.parse(c));if(c&&(c.groupOp&&b.SearchFilter.setGroupOp(c.groupOp),c.rules)){var h,e=0,f=c.rules.length;for(h=!1;e<f;e++)h=c.rules[e],void 0!==h.field&&void 0!==h.op&&void 0!==h.data&&(h=b.SearchFilter.setFilter({sfref:b.SearchFilter.$.find(".sf:last"),filter:a.extend({},h)}))&&b.SearchFilter.add()}}function d(c){if(b.onClose){var d=b.onClose(c);if("boolean"==typeof d&&!d)return}c.hide();!0===b.overlay&&a(".jqgrid-overlay:first","#gbox_"+l.p.id).hide()}
function g(){var c=a(".ui-searchFilter").length;if(1<c){var d=a("#"+e).css("zIndex");a("#"+e).css({zIndex:parseInt(d,10)+c})}a("#"+e).show();!0===b.overlay&&a(".jqgrid-overlay:first","#gbox_"+l.p.id).show();try{a(":input:visible","#"+e)[0].focus()}catch(h){}}function s(c){var h=void 0!==c,f=a("#"+l.p.id),r={};!1===b.multipleSearch?(r[b.sField]=c.rules[0].field,r[b.sValue]=c.rules[0].data,r[b.sOper]=c.rules[0].op,r.hasOwnProperty(b.sFilter)&&delete r[b.sFilter]):(r[b.sFilter]=c,a.each([b.sField,b.sValue,
b.sOper],function(a,c){r.hasOwnProperty(c)&&delete r[c]}));f[0].p.search=h;a.extend(f[0].p.postData,r);f.trigger("reloadGrid",[{page:1}]);b.closeAfterSearch&&d(a("#"+e))}function q(c){c=c&&c.hasOwnProperty("reload")?c.reload:!0;var h=a("#"+l.p.id),f={};h[0].p.search=!1;!1===b.multipleSearch?f[b.sField]=f[b.sValue]=f[b.sOper]="":f[b.sFilter]="";a.extend(h[0].p.postData,f);c&&h.trigger("reloadGrid",[{page:1}]);b.closeAfterReset&&d(a("#"+e))}var l=this;if(l.grid){var e="fbox_"+l.p.id,n=!0;if(a.fn.searchFilter)if(!0===
b.recreateFilter&&a("#"+e).remove(),null!=a("#"+e).html())a.isFunction(b.beforeShowSearch)&&(n=b.beforeShowSearch(a("#"+e)),"undefined"==typeof n&&(n=!0)),!1!==n&&(g(),a.isFunction(b.afterShowSearch)&&b.afterShowSearch(a("#"+e)));else{var m=[],w=a("#"+l.p.id).jqGrid("getGridParam","colNames"),r=a("#"+l.p.id).jqGrid("getGridParam","colModel"),h="eq ne lt le gt ge bw bn in ni ew en cn nc".split(" "),c,f,v,t=[];if(null!==b.sopt)for(c=v=0;c<b.sopt.length;c++)-1!=(f=a.inArray(b.sopt[c],h))&&(t[v]={op:b.sopt[c],
text:b.odata[f].text},v++);else for(c=0;c<h.length;c++)t[c]={op:h[c],text:b.odata[c].text};a.each(r,function(d,e){var r="undefined"===typeof e.search?!0:e.search,l=!0===e.hidden,k=a.extend({},{text:w[d],itemval:e.index||e.name},this.searchoptions),n=!0===k.searchhidden;if("undefined"!==typeof k.sopt&&(v=0,k.ops=[],0<k.sopt.length))for(c=0;c<k.sopt.length;c++)-1!=(f=a.inArray(k.sopt[c],h))&&(k.ops[v]={op:k.sopt[c],text:b.odata[f].text},v++);"undefined"===typeof this.stype&&(this.stype="text");if("select"==
this.stype&&void 0===k.dataUrl){var g;k.value?g=k.value:this.editoptions&&(g=this.editoptions.value);if(g)if(k.dataValues=[],"string"===typeof g){g=g.split(";");var t;for(c=0;c<g.length;c++)t=g[c].split(":"),k.dataValues[c]={value:t[0],text:t[1]}}else if("object"===typeof g)for(t in c=0,g)g.hasOwnProperty(t)&&(k.dataValues[c]={value:t,text:g[t]},c++)}(n&&r||r&&!l)&&m.push(k)});if(0<m.length){a("\x3cdiv id\x3d'"+e+"' role\x3d'dialog' tabindex\x3d'-1'\x3e\x3c/div\x3e").insertBefore("#gview_"+l.p.id);
void 0===b.stringResult&&(b.stringResult=b.multipleSearch);l.SearchFilter=a("#"+e).searchFilter(m,{groupOps:b.groupOps,operators:t,onClose:d,resetText:b.Reset,searchText:b.Find,windowTitle:b.caption,rulesText:b.rulesText,matchText:b.matchText,onSearch:s,onReset:q,stringResult:b.stringResult,ajaxSelectOptions:a.extend({},a.jgrid.ajaxOptions,l.p.ajaxSelectOptions||{}),clone:b.cloneSearchRowOnAdd});a(".ui-widget-overlay","#"+e).remove();"rtl"==l.p.direction&&a(".ui-closer","#"+e).css("float","left");
if(!0===b.drag)if(a("#"+e+" table thead tr:first td:first").css("cursor","move"),jQuery.fn.jqDrag)a("#"+e).jqDrag(a("#"+e+" table thead tr:first td:first"));else try{a("#"+e).draggable({handle:a("#"+e+" table thead tr:first td:first")})}catch(k){}!1===b.multipleSearch&&(a(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+e).hide(),a("select[name\x3d'groupOp']","#"+e).hide());!0===b.multipleSearch&&!0===b.loadDefaults&&p(l,b);if(a.isFunction(b.onInitializeSearch))b.onInitializeSearch(a("#"+
e));a.isFunction(b.beforeShowSearch)&&(n=b.beforeShowSearch(a("#"+e)),"undefined"==typeof n&&(n=!0));!1!==n&&(g(),a.isFunction(b.afterShowSearch)&&b.afterShowSearch(a("#"+e)),!0===b.closeOnEscape&&a("#"+e).keydown(function(c){27==c.which&&d(a("#"+e));13==c.which&&a(".ui-search",this).click()}))}}}})},updateGridRows:function(b,p,d){var g,s=!1,q;this.each(function(){var l=this,e,n,m,w;if(!l.grid)return!1;p||(p="id");b&&0<b.length&&a(b).each(function(b){m=this;if(n=l.rows.namedItem(m[p])){w=m[p];if(!0===
d&&!0===l.p.jsonReader.repeatitems){l.p.jsonReader.cell&&(m=m[l.p.jsonReader.cell]);for(b=0;b<m.length;b++)e=l.formatter(w,m[b],b,m,"edit"),q=l.p.colModel[b].title?{title:a.jgrid.stripHtml(e)}:{},!0===l.p.treeGrid&&g==l.p.ExpandColumn?a("td:eq("+b+") \x3e span:first",n).html(e).attr(q):a("td:eq("+b+")",n).html(e).attr(q);return s=!0}a(l.p.colModel).each(function(b){g=!0===d?this.jsonmap||this.name:this.name;void 0!==m[g]&&(e=l.formatter(w,m[g],b,m,"edit"),q=this.title?{title:a.jgrid.stripHtml(e)}:
{},!0===l.p.treeGrid&&g==l.p.ExpandColumn?a("td:eq("+b+") \x3e span:first",n).html(e).attr(q):a("td:eq("+b+")",n).html(e).attr(q),s=!0)})}})});return s},filterGrid:function(b,p){p=a.extend({gridModel:!1,gridNames:!1,gridToolbar:!1,filterModel:[],formtype:"horizontal",autosearch:!0,formclass:"filterform",tableclass:"filtertable",buttonclass:"filterbutton",searchButton:"Search",clearButton:"Clear",enableSearch:!1,enableClear:!1,beforeSearch:null,afterSearch:null,beforeClear:null,afterClear:null,url:"",
marksearched:!0},p||{});return this.each(function(){var d=this;this.p=p;if(0===this.p.filterModel.length&&!1===this.p.gridModel)alert("No filter is set");else if(b){this.p.gridid=-1!=b.indexOf("#")?b:"#"+b;var g=a(this.p.gridid).jqGrid("getGridParam","colModel");if(g){if(!0===this.p.gridModel){var s=a(this.p.gridid)[0],q;a.each(g,function(a,b){var h=[];this.search=!1===this.search?!1:!0;q=this.editrules&&!0===this.editrules.searchhidden?!0:!0===this.hidden?!1:!0;!0===this.search&&!0===q&&(h.label=
!0===d.p.gridNames?s.p.colNames[a]:"",h.name=this.name,h.index=this.index||this.name,h.stype=this.edittype||"text","select"!=h.stype&&(h.stype="text"),h.defval=this.defval||"",h.surl=this.surl||"",h.sopt=this.editoptions||{},h.width=this.width,d.p.filterModel.push(h))})}else a.each(d.p.filterModel,function(a,b){for(var d=0;d<g.length;d++)if(this.name==g[d].name){this.index=g[d].index||this.name;break}this.index||(this.index=this.name)});var l=function(){var b={},e=0,h,c=a(d.p.gridid)[0],f;c.p.searchdata=
{};a.isFunction(d.p.beforeSearch)&&d.p.beforeSearch();a.each(d.p.filterModel,function(k,l){f=this.index;if("select"===this.stype)if(h=a("select[name\x3d"+f+"]",d).val())b[f]=h,d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).addClass("dirty-cell"),e++;else{d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).removeClass("dirty-cell");try{delete c.p.postData[this.index]}catch(g){}}else if(h=a("input[name\x3d"+f+"]",d).val())b[f]=h,d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).addClass("dirty-cell"),
e++;else{d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).removeClass("dirty-cell");try{delete c.p.postData[this.index]}catch(n){}}});var l=0<e?!0:!1;a.extend(c.p.postData,b);var g;d.p.url&&(g=a(c).jqGrid("getGridParam","url"),a(c).jqGrid("setGridParam",{url:d.p.url}));a(c).jqGrid("setGridParam",{search:l}).trigger("reloadGrid",[{page:1}]);g&&a(c).jqGrid("setGridParam",{url:g});a.isFunction(d.p.afterSearch)&&d.p.afterSearch()},e=function(){var b={},e,h=0,c=a(d.p.gridid)[0],f;a.isFunction(d.p.beforeClear)&&
d.p.beforeClear();a.each(d.p.filterModel,function(k,l){f=this.index;e=this.defval?this.defval:"";this.stype||(this.stype="text");switch(this.stype){case "select":var g;a("select[name\x3d"+f+"] option",d).each(function(b){0===b&&(this.selected=!0);if(a(this).text()==e)return this.selected=!0,g=a(this).val(),!1});if(g)b[f]=g,d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).addClass("dirty-cell"),h++;else{d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).removeClass("dirty-cell");try{delete c.p.postData[this.index]}catch(n){}}break;
case "text":if(a("input[name\x3d"+f+"]",d).val(e),e)b[f]=e,d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).addClass("dirty-cell"),h++;else{d.p.marksearched&&a("#jqgh_"+this.name,c.grid.hDiv).removeClass("dirty-cell");try{delete c.p.postData[this.index]}catch(m){}}}});var l=0<h?!0:!1;a.extend(c.p.postData,b);var g;d.p.url&&(g=a(c).jqGrid("getGridParam","url"),a(c).jqGrid("setGridParam",{url:d.p.url}));a(c).jqGrid("setGridParam",{search:l}).trigger("reloadGrid",[{page:1}]);g&&a(c).jqGrid("setGridParam",
{url:g});a.isFunction(d.p.afterClear)&&d.p.afterClear()},n,m=a("\x3cform name\x3d'SearchForm' style\x3ddisplay:inline;' class\x3d'"+this.p.formclass+"'\x3e\x3c/form\x3e");n=a("\x3ctable class\x3d'"+this.p.tableclass+"' cellspacing\x3d'0' cellpadding\x3d'0' border\x3d'0'\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e");a(m).append(n);(function(){var b=document.createElement("tr"),g,h,c,f;"horizontal"==d.p.formtype&&a(n).append(b);a.each(d.p.filterModel,function(e,h){c=document.createElement("td");a(c).append("\x3clabel for\x3d'"+
this.name+"'\x3e"+this.label+"\x3c/label\x3e");f=document.createElement("td");var k=this;this.stype||(this.stype="text");switch(this.stype){case "select":if(this.surl)a(f).load(this.surl,function(){k.defval&&a("select",this).val(k.defval);a("select",this).attr({name:k.index||k.name,id:"sg_"+k.name});k.sopt&&a("select",this).attr(k.sopt);!0===d.p.gridToolbar&&k.width&&a("select",this).width(k.width);!0===d.p.autosearch&&a("select",this).change(function(a){l();return!1})});else if(k.sopt.value){var m=
k.sopt.value,q=document.createElement("select");a(q).attr({name:k.index||k.name,id:"sg_"+k.name}).attr(k.sopt);var p,u;if("string"===typeof m)for(var m=m.split(";"),s=0;s<m.length;s++)p=m[s].split(":"),u=document.createElement("option"),u.value=p[0],u.innerHTML=p[1],p[1]==k.defval&&(u.selected="selected"),q.appendChild(u);else if("object"===typeof m)for(p in m)m.hasOwnProperty(p)&&(e++,u=document.createElement("option"),u.value=p,u.innerHTML=m[p],m[p]==k.defval&&(u.selected="selected"),q.appendChild(u));
!0===d.p.gridToolbar&&k.width&&a(q).width(k.width);a(f).append(q);!0===d.p.autosearch&&a(q).change(function(a){l();return!1})}break;case "text":q=this.defval?this.defval:"",a(f).append("\x3cinput type\x3d'text' name\x3d'"+(this.index||this.name)+"' id\x3d'sg_"+this.name+"' value\x3d'"+q+"'/\x3e"),k.sopt&&a("input",f).attr(k.sopt),!0===d.p.gridToolbar&&k.width&&(a.browser.msie?a("input",f).width(k.width-4):a("input",f).width(k.width-2)),!0===d.p.autosearch&&a("input",f).keypress(function(a){return 13==
(a.charCode?a.charCode:a.keyCode?a.keyCode:0)?(l(),!1):this})}"horizontal"==d.p.formtype?(!0===d.p.gridToolbar&&!1===d.p.gridNames?a(b).append(f):a(b).append(c).append(f),a(b).append(f)):(g=document.createElement("tr"),a(g).append(c).append(f),a(n).append(g))});f=document.createElement("td");!0===d.p.enableSearch&&(h="\x3cinput type\x3d'button' id\x3d'sButton' class\x3d'"+d.p.buttonclass+"' value\x3d'"+d.p.searchButton+"'/\x3e",a(f).append(h),a("input#sButton",f).click(function(){l();return!1}));
!0===d.p.enableClear&&(h="\x3cinput type\x3d'button' id\x3d'cButton' class\x3d'"+d.p.buttonclass+"' value\x3d'"+d.p.clearButton+"'/\x3e",a(f).append(h),a("input#cButton",f).click(function(){e();return!1}));if(!0===d.p.enableClear||!0===d.p.enableSearch)"horizontal"==d.p.formtype?a(b).append(f):(g=document.createElement("tr"),a(g).append("\x3ctd\x3e\x26#160;\x3c/td\x3e").append(f),a(n).append(g))})();a(this).append(m);this.triggerSearch=l;this.clearSearch=e}else alert("Could not get grid colModel")}else alert("No target grid is set!")})}})})(jQuery);