'use strict';(function(a){a.jgrid.inlineEdit=a.jgrid.inlineEdit||{};a.jgrid.extend({editRow:function(c,e,b,m,l,n,q,g,d){var h={},f=a.makeArray(arguments).slice(1);"object"===a.type(f[0])?h=f[0]:(void 0!==e&&(h.keys=e),a.isFunction(b)&&(h.oneditfunc=b),a.isFunction(m)&&(h.successfunc=m),void 0!==l&&(h.url=l),void 0!==n&&(h.extraparam=n),a.isFunction(q)&&(h.aftersavefunc=q),a.isFunction(g)&&(h.errorfunc=g),a.isFunction(d)&&(h.afterrestorefunc=d));h=a.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,
url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",focusField:!0},a.jgrid.inlineEdit,h);return this.each(function(){var d=this,f,e,b,g=0,l=null,n={},m,p;d.grid&&(m=a(d).jqGrid("getInd",c,!0),!1!==m&&(b=a.isFunction(h.beforeEditRow)?h.beforeEditRow.call(d,h,c):void 0,void 0===b&&(b=!0),b&&(b=a(m).attr("editable")||"0","0"!==b||a(m).hasClass("not-editable-row")||(p=d.p.colModel,a('td[role\x3d"gridcell"]',m).each(function(b){f=p[b].name;var h=
!0===d.p.treeGrid&&f===d.p.ExpandColumn;if(h)e=a("span:first",this).html();else try{e=a.unformat.call(d,this,{rowId:c,colModel:p[b]},b)}catch(m){e=p[b].edittype&&"textarea"===p[b].edittype?a(this).text():a(this).html()}if("cb"!==f&&"subgrid"!==f&&"rn"!==f&&(d.p.autoencode&&(e=a.jgrid.htmlDecode(e)),n[f]=e,!0===p[b].editable)){null===l&&(l=b);h?a("span:first",this).html(""):a(this).html("");var q=a.extend({},p[b].editoptions||{},{id:c+"_"+f,name:f,rowId:c});p[b].edittype||(p[b].edittype="text");if("\x26nbsp;"===
e||"\x26#160;"===e||1===e.length&&160===e.charCodeAt(0))e="";var x=a.jgrid.createEl.call(d,p[b].edittype,q,e,!0,a.extend({},a.jgrid.ajaxOptions,d.p.ajaxSelectOptions||{}));a(x).addClass("editable");h?a("span:first",this).append(x):a(this).append(x);a.jgrid.bindEv.call(d,x,q);"select"===p[b].edittype&&void 0!==p[b].editoptions&&!0===p[b].editoptions.multiple&&void 0===p[b].editoptions.dataUrl&&a.jgrid.msie&&a(x).width(a(x).width());g++}}),0<g&&(n.id=c,d.p.savedRow.push(n),a(m).attr("editable","1"),
h.focusField&&("number"===typeof h.focusField&&parseInt(h.focusField,10)<=p.length&&(l=h.focusField),setTimeout(function(){var d=a("td:eq("+l+") :input:visible",m).not(":disabled");0<d.length&&d.focus()},0)),!0===h.keys&&a(m).bind("keydown",function(b){if(27===b.keyCode){a(d).jqGrid("restoreRow",c,h.afterrestorefunc);if(d.p._inlinenav)try{a(d).jqGrid("showAddEditButtons")}catch(f){}return!1}if(13===b.keyCode){if("TEXTAREA"===b.target.tagName)return!0;if(a(d).jqGrid("saveRow",c,h)&&d.p._inlinenav)try{a(d).jqGrid("showAddEditButtons")}catch(e){}return!1}}),
a(d).triggerHandler("jqGridInlineEditRow",[c,h]),a.isFunction(h.oneditfunc)&&h.oneditfunc.call(d,c))))))})},saveRow:function(c,e,b,m,l,n,q){var g=a.makeArray(arguments).slice(1),d={};"object"===a.type(g[0])?d=g[0]:(a.isFunction(e)&&(d.successfunc=e),void 0!==b&&(d.url=b),void 0!==m&&(d.extraparam=m),a.isFunction(l)&&(d.aftersavefunc=l),a.isFunction(n)&&(d.errorfunc=n),a.isFunction(q)&&(d.afterrestorefunc=q));var d=a.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,
afterrestorefunc:null,restoreAfterError:!0,mtype:"POST",saveui:"enable",savetext:a.jgrid.defaults.savetext||"Saving..."},a.jgrid.inlineEdit,d),h=!1,f=this[0],r,k={},y={},v={},w,z,u;if(!f.grid)return h;u=a(f).jqGrid("getInd",c,!0);if(!1===u)return h;g=a.isFunction(d.beforeSaveRow)?d.beforeSaveRow.call(f,d,c):void 0;void 0===g&&(g=!0);if(g){g=a(u).attr("editable");d.url=d.url||f.p.editurl;if("1"===g){var t;a('td[role\x3d"gridcell"]',u).each(function(c){t=f.p.colModel[c];r=t.name;if("cb"!==r&&"subgrid"!==
r&&!0===t.editable&&"rn"!==r&&!a(this).hasClass("not-editable-cell")){switch(t.edittype){case "checkbox":var b=["Yes","No"];t.editoptions&&(b=t.editoptions.value.split(":"));k[r]=a("input",this).is(":checked")?b[0]:b[1];break;case "text":case "password":case "textarea":case "button":k[r]=a("input, textarea",this).val();break;case "select":if(t.editoptions.multiple){var b=a("select",this),e=[];k[r]=a(b).val();k[r]=k[r]?k[r].join(","):"";a("select option:selected",this).each(function(d,c){e[d]=a(c).text()});
y[r]=e.join(",")}else k[r]=a("select option:selected",this).val(),y[r]=a("select option:selected",this).text();t.formatter&&"select"===t.formatter&&(y={});break;case "custom":try{if(t.editoptions&&a.isFunction(t.editoptions.custom_value)){if(k[r]=t.editoptions.custom_value.call(f,a(".customelement",this),"get"),void 0===k[r])throw"e2";}else throw"e1";}catch(g){"e1"===g&&a.jgrid.info_dialog(a.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,a.jgrid.edit.bClose),"e2"===g?a.jgrid.info_dialog(a.jgrid.errors.errcap,
"function 'custom_value' "+a.jgrid.edit.msg.novalue,a.jgrid.edit.bClose):a.jgrid.info_dialog(a.jgrid.errors.errcap,g.message,a.jgrid.edit.bClose)}}z=a.jgrid.checkValues.call(f,k[r],c);if(!1===z[0])return!1;f.p.autoencode&&(k[r]=a.jgrid.htmlEncode(k[r]));"clientArray"!==d.url&&t.editoptions&&!0===t.editoptions.NullIfEmpty&&""===k[r]&&(v[r]="null")}});if(!1===z[0]){try{var p=a(f).jqGrid("getGridRowById",c),s=a.jgrid.findPos(p);a.jgrid.info_dialog(a.jgrid.errors.errcap,z[1],a.jgrid.edit.bClose,{left:s[0],
top:s[1]+a(p).outerHeight()})}catch(A){alert(z[1])}return h}g=f.p.prmNames;p=c;s=!1===f.p.keyName?g.id:f.p.keyName;k&&(k[g.oper]=g.editoper,void 0===k[s]||""===k[s]?k[s]=c:u.id!==f.p.idPrefix+k[s]&&(g=a.jgrid.stripPref(f.p.idPrefix,c),void 0!==f.p._index[g]&&(f.p._index[k[s]]=f.p._index[g],delete f.p._index[g]),c=f.p.idPrefix+k[s],a(u).attr("id",c),f.p.selrow===p&&(f.p.selrow=c),a.isArray(f.p.selarrrow)&&(g=a.inArray(p,f.p.selarrrow),0<=g&&(f.p.selarrrow[g]=c)),f.p.multiselect&&(g="jqg_"+f.p.id+"_"+
c,a("input.cbox",u).attr("id",g).attr("name",g))),void 0===f.p.inlineData&&(f.p.inlineData={}),k=a.extend({},k,f.p.inlineData,d.extraparam));if("clientArray"===d.url){k=a.extend({},k,y);f.p.autoencode&&a.each(k,function(d,c){k[d]=a.jgrid.htmlDecode(c)});g=a(f).jqGrid("setRowData",c,k);a(u).attr("editable","0");for(s=0;s<f.p.savedRow.length;s++)if(String(f.p.savedRow[s].id)===String(p)){w=s;break}0<=w&&f.p.savedRow.splice(w,1);a(f).triggerHandler("jqGridInlineAfterSaveRow",[c,g,k,d]);a.isFunction(d.aftersavefunc)&&
d.aftersavefunc.call(f,c,g,k,d);h=!0;a(u).removeClass("jqgrid-new-row").unbind("keydown")}else a(f).jqGrid("progressBar",{method:"show",loadtype:d.saveui,htmlcontent:d.savetext}),v=a.extend({},k,v),v[s]=a.jgrid.stripPref(f.p.idPrefix,v[s]),a.ajax(a.extend({url:d.url,data:a.isFunction(f.p.serializeRowData)?f.p.serializeRowData.call(f,v):v,type:d.mtype,async:!1,complete:function(b,e){a(f).jqGrid("progressBar",{method:"hide",loadtype:d.saveui,htmlcontent:d.savetext});if("success"===e){var g=!0,l;l=a(f).triggerHandler("jqGridInlineSuccessSaveRow",
[b,c,d]);a.isArray(l)||(l=[!0,k]);l[0]&&a.isFunction(d.successfunc)&&(l=d.successfunc.call(f,b));a.isArray(l)?(g=l[0],k=l[1]||k):g=l;if(!0===g){f.p.autoencode&&a.each(k,function(d,b){k[d]=a.jgrid.htmlDecode(b)});k=a.extend({},k,y);a(f).jqGrid("setRowData",c,k);a(u).attr("editable","0");for(g=0;g<f.p.savedRow.length;g++)if(String(f.p.savedRow[g].id)===String(c)){w=g;break}0<=w&&f.p.savedRow.splice(w,1);a(f).triggerHandler("jqGridInlineAfterSaveRow",[c,b,k,d]);a.isFunction(d.aftersavefunc)&&d.aftersavefunc.call(f,
c,b,k,d);h=!0;a(u).removeClass("jqgrid-new-row").unbind("keydown")}else a(f).triggerHandler("jqGridInlineErrorSaveRow",[c,b,e,null,d]),a.isFunction(d.errorfunc)&&d.errorfunc.call(f,c,b,e,null),!0===d.restoreAfterError&&a(f).jqGrid("restoreRow",c,d.afterrestorefunc)}},error:function(b,e,g){a("#lui_"+a.jgrid.jqID(f.p.id)).hide();a(f).triggerHandler("jqGridInlineErrorSaveRow",[c,b,e,g,d]);if(a.isFunction(d.errorfunc))d.errorfunc.call(f,c,b,e,g);else{b=b.responseText||b.statusText;try{a.jgrid.info_dialog(a.jgrid.errors.errcap,
'\x3cdiv class\x3d"ui-state-error"\x3e'+b+"\x3c/div\x3e",a.jgrid.edit.bClose,{buttonalign:"right"})}catch(l){alert(b)}}!0===d.restoreAfterError&&a(f).jqGrid("restoreRow",c,d.afterrestorefunc)}},a.jgrid.ajaxOptions,f.p.ajaxRowOptions||{}))}return h}},restoreRow:function(c,e){var b=a.makeArray(arguments).slice(1),m={};"object"===a.type(b[0])?m=b[0]:a.isFunction(e)&&(m.afterrestorefunc=e);m=a.extend(!0,{},a.jgrid.inlineEdit,m);return this.each(function(){var b=this,e=-1,q,g={},d;if(b.grid&&(q=a(b).jqGrid("getInd",
c,!0),!1!==q&&(d=a.isFunction(m.beforeCancelRow)?m.beforeCancelRow.call(b,m,c):void 0,void 0===d&&(d=!0),d))){for(d=0;d<b.p.savedRow.length;d++)if(String(b.p.savedRow[d].id)===String(c)){e=d;break}if(0<=e){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(q.id)).datepicker("hide")}catch(h){}a.each(b.p.colModel,function(){!0===this.editable&&b.p.savedRow[e].hasOwnProperty(this.name)&&(g[this.name]=b.p.savedRow[e][this.name])});a(b).jqGrid("setRowData",c,g);a(q).attr("editable",
"0").unbind("keydown");b.p.savedRow.splice(e,1);a("#"+a.jgrid.jqID(c),"#"+a.jgrid.jqID(b.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){a(b).jqGrid("delRowData",c);a(b).jqGrid("showAddEditButtons")},0)}a(b).triggerHandler("jqGridInlineAfterRestoreRow",[c]);a.isFunction(m.afterrestorefunc)&&m.afterrestorefunc.call(b,c)}})},addRow:function(c){c=a.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,addRowParams:{extraparam:{}}},c||{});return this.each(function(){if(this.grid){var e=
this,b=a.isFunction(c.beforeAddRow)?c.beforeAddRow.call(e,c.addRowParams):void 0;void 0===b&&(b=!0);b&&(c.rowID=a.isFunction(c.rowID)?c.rowID.call(e,c):null!=c.rowID?c.rowID:a.jgrid.randId(),!0===c.useDefValues&&a(e.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var b=this.editoptions.defaultValue,b=a.isFunction(b)?b.call(e):b;c.initdata[this.name]=b}}),a(e).jqGrid("addRowData",c.rowID,c.initdata,c.position),c.rowID=e.p.idPrefix+c.rowID,a("#"+a.jgrid.jqID(c.rowID),
"#"+a.jgrid.jqID(e.p.id)).addClass("jqgrid-new-row"),c.useFormatter?a("#"+a.jgrid.jqID(c.rowID)+" .ui-inline-edit","#"+a.jgrid.jqID(e.p.id)).click():(b=e.p.prmNames,c.addRowParams.extraparam[b.oper]=b.addoper,a(e).jqGrid("editRow",c.rowID,c.addRowParams),a(e).jqGrid("setSelection",c.rowID)))}})},inlineNav:function(c,e){e=a.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",addParams:{addRowParams:{extraparam:{}}},
editParams:{},restoreAfterSelect:!0},a.jgrid.nav,e||{});return this.each(function(){if(this.grid){var b=this,m,l=a.jgrid.jqID(b.p.id);b.p._inlinenav=!0;if(!0===e.addParams.useFormatter){var n=b.p.colModel,q;for(q=0;q<n.length;q++)if(n[q].formatter&&"actions"===n[q].formatter){n[q].formatoptions&&(n=a.extend({keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},n[q].formatoptions),e.addParams.addRowParams={keys:n.keys,oneditfunc:n.onEdit,successfunc:n.onSuccess,
url:n.url,extraparam:n.extraparam,aftersavefunc:n.afterSave,errorfunc:n.onError,afterrestorefunc:n.afterRestore});break}}e.add&&a(b).jqGrid("navButtonAdd",c,{caption:e.addtext,title:e.addtitle,buttonicon:e.addicon,id:b.p.id+"_iladd",onClickButton:function(){a(b).jqGrid("addRow",e.addParams);e.addParams.useFormatter||(a("#"+l+"_ilsave").removeClass("ui-state-disabled"),a("#"+l+"_ilcancel").removeClass("ui-state-disabled"),a("#"+l+"_iladd").addClass("ui-state-disabled"),a("#"+l+"_iledit").addClass("ui-state-disabled"))}});
e.edit&&a(b).jqGrid("navButtonAdd",c,{caption:e.edittext,title:e.edittitle,buttonicon:e.editicon,id:b.p.id+"_iledit",onClickButton:function(){var c=a(b).jqGrid("getGridParam","selrow");c?(a(b).jqGrid("editRow",c,e.editParams),a("#"+l+"_ilsave").removeClass("ui-state-disabled"),a("#"+l+"_ilcancel").removeClass("ui-state-disabled"),a("#"+l+"_iladd").addClass("ui-state-disabled"),a("#"+l+"_iledit").addClass("ui-state-disabled")):(a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+l,jqm:!0}),a("#jqg_alrt").focus())}});
e.save&&(a(b).jqGrid("navButtonAdd",c,{caption:e.savetext||"",title:e.savetitle||"Save row",buttonicon:e.saveicon,id:b.p.id+"_ilsave",onClickButton:function(){var c=b.p.savedRow[0].id;if(c){var d=b.p.prmNames,h=d.oper,f=e.editParams;a("#"+a.jgrid.jqID(c),"#"+l).hasClass("jqgrid-new-row")?(e.addParams.addRowParams.extraparam[h]=d.addoper,f=e.addParams.addRowParams):(e.editParams.extraparam||(e.editParams.extraparam={}),e.editParams.extraparam[h]=d.editoper);a(b).jqGrid("saveRow",c,f)&&a(b).jqGrid("showAddEditButtons")}else a.jgrid.viewModal("#alertmod",
{gbox:"#gbox_"+l,jqm:!0}),a("#jqg_alrt").focus()}}),a("#"+l+"_ilsave").addClass("ui-state-disabled"));e.cancel&&(a(b).jqGrid("navButtonAdd",c,{caption:e.canceltext||"",title:e.canceltitle||"Cancel row editing",buttonicon:e.cancelicon,id:b.p.id+"_ilcancel",onClickButton:function(){var c=b.p.savedRow[0].id,d=e.editParams;c?(a("#"+a.jgrid.jqID(c),"#"+l).hasClass("jqgrid-new-row")&&(d=e.addParams.addRowParams),a(b).jqGrid("restoreRow",c,d),a(b).jqGrid("showAddEditButtons")):(a.jgrid.viewModal("#alertmod",
{gbox:"#gbox_"+l,jqm:!0}),a("#jqg_alrt").focus())}}),a("#"+l+"_ilcancel").addClass("ui-state-disabled"));!0===e.restoreAfterSelect&&(m=a.isFunction(b.p.beforeSelectRow)?b.p.beforeSelectRow:!1,b.p.beforeSelectRow=function(c,d){var h=!0;0<b.p.savedRow.length&&!0===b.p._inlinenav&&c!==b.p.selrow&&null!==b.p.selrow&&(b.p.selrow===e.addParams.rowID?a(b).jqGrid("delRowData",b.p.selrow):a(b).jqGrid("restoreRow",b.p.selrow,e.editParams),a(b).jqGrid("showAddEditButtons"));m&&(h=m.call(b,c,d));return h})}})},
showAddEditButtons:function(){return this.each(function(){if(this.grid){var c=a.jgrid.jqID(this.p.id);a("#"+c+"_ilsave").addClass("ui-state-disabled");a("#"+c+"_ilcancel").addClass("ui-state-disabled");a("#"+c+"_iladd").removeClass("ui-state-disabled");a("#"+c+"_iledit").removeClass("ui-state-disabled")}})}})})(jQuery);