/*

 jquery.grid.struts2.js

 Integration of jqGrid with struts 2

 Requires use of jquery.struts2.js

 Copyright (c) 2010 - 2015 Johannes Geppert http://www.jgeppert.com

 Dual licensed under the MIT and GPL licenses:
   http://www.opensource.org/licenses/mit-license.php
   http://www.gnu.org/licenses/gpl.html

*/
'use strict';(function(h){h.struts2_jquery_grid={lastselectedrow:"",navigatorButtons:function(c,a,d){var b=this;h.each(a,function(a,f){if(f.title)if("seperator"===f.title)c.jqGrid("navSeparatorAdd",d);else if(f.topic||f.onclick){var e={};f.id&&(e.id=f.id);f.title&&(e.title=f.title);f.position&&(e.position=f.position);e.caption=f.caption?f.caption:"";e.buttonicon=f.icon?f.icon:"ui-icon-gear";f.topic?e.onClickButton=function(){var a={};a.grid=c;b.publishTopic(c,f.topic,a)}:f.onclick&&(e.onClickButton=
f.onclick);c.jqGrid("navButtonAdd",d,e)}})},parseGridParams:function(c,a,d){var b=this;if(a.onselectrowtopics||a.editurl&&!0===a.editinline)d.onSelectRow=function(f,e){var g={},k=null,d=null,l=null,m=null;g.id=f;g.status=e;g.grid=c;b.publishTopic(c,a.onalw,g);h.struts2_jquery.publishTopic(c,a.onselectrowtopics,g);a.editurl&&!0===a.editinline&&!1===a.navinline&&(""!==b.lastselectedrow&&c.jqGrid("restoreRow",b.lastselectedrow),b.lastselectedrow=f,a.oneibefore&&(k=function(){b.publishTopic(c,a.oneibefore,
g)}),a.oneisuccess&&(d=function(f){var e={};e.response=f;b.publishTopic(c,a.oneisuccess,e);return 400<=f.status?!1:!0}),a.oneierror&&(l=function(f,e){var g={};g.rowid=f;g.response=e;b.publishTopic(c,a.oneierror,g)}),a.oneisave&&(m=function(f,e){var g={};g.rowid=f;g.response=e;b.publishTopic(c,a.oneisave,g)}),c.jqGrid("editRow",f,!0,k,d,null,null,m,l,null))};a.oncesuccess&&(d.afterSaveCell=function(f,e,g,k,d){var l={};l.rowid=f;l.cellname=e;l.value=g;l.iRow=k;l.iCol=d;b.publishTopic(c,a.oncesuccess,
l)});a.onceerror&&(d.errorCell=function(f,e){var g={};g.response=f;g.status=e;b.publishTopic(c,a.onceerror,g)});a.onselectalltopics&&(d.onSelectAll=function(f,e){var g={};g.ids=f;g.status=e;g.grid=c;b.publishTopic(c,a.onalw,g);b.publishTopic(c,a.onselectalltopics,g)});a.onbef&&(d.loadBeforeSend=function(f){var e={};e.xhr=f;e.proceed=!0;b.publishTopic(c,a.onalw,e);b.publishTopic(c,a.onbef,e);return e.proceed});a.onpagingtopics&&(d.onPaging=function(f){var e={};e.pgButton=f;b.publishTopic(c,a.onalw,
e);b.publishTopic(c,a.onpagingtopics,e)});a.onsortcoltopics&&(d.onSortCol=function(f,e,g){var k={};k.index=f;k.iCol=e;k.sortorder=g;b.publishTopic(c,a.onalw,k);b.publishTopic(c,a.onsortcoltopics,k)});a.oncellselecttopics&&(d.onCellSelect=function(f,e,g,k){var d={};d.rowid=f;d.iCol=e;d.cellcontent=g;d.e=k;b.publishTopic(c,a.onalw,d);b.publishTopic(c,a.oncellselecttopics,d)});a.onclickgroup&&(d.onClickGroup=function(f,e){var g={};g.groupid=f;g.collapsed=e;b.publishTopic(c,a.onalw,g);b.publishTopic(c,
a.onclickgroup,g)});a.ondblclickrow&&(d.ondblClickRow=function(f,e,g,d){var h={};h.rowid=f;h.iRow=e;h.iCol=g;h.e=d;b.publishTopic(c,a.onalw,h);b.publishTopic(c,a.ondblclickrow,h)});a.onrightclickrow&&(d.onRightClickRow=function(f,e,g,d){var h={};h.rowid=f;h.iRow=e;h.iCol=g;h.e=d;b.publishTopic(c,a.onalw,h);b.publishTopic(c,a.onrightclickrow,h)});d.gridComplete=function(f){f=a.draggableoptions;var e=window[f],g=a.droppableoptions,d=window[g],h=a.sortableoptions,l=window[h],m=a.resizableoptions,n=window[m],
q={},p={},s={};c.data("_s2jg_init")||(c.data("_s2jg_init",!0),a.draggable&&a.droppable&&(b.log("drag and drop for grid : "+a.id),b.loadAtOnce||b.require(["js/base/widget"+b.minSuffix+".js","js/base/mouse"+b.minSuffix+".js","js/base/draggable"+b.minSuffix+".js","js/base/droppable"+b.minSuffix+".js"]),e=e?{}:eval("( "+f+" )"),e.drap=b.pubTops(c,a.onalw,a.draggableondragtopics),d=d?{}:eval("( "+g+" )"),d.activate=b.pubTops(c,a.onalw,a.droppableonactivatetopics),d.deactivate=b.pubTops(c,a.onalw,a.droppableondeactivatetopics),
d.start=b.pubTops(c,a.onalw,a.droppableonstarttopics),d.stop=b.pubTops(c,a.onalw,a.droppableonstoptopics),q.drag_opts=e,q.drop_opts=d,q.connectWith=a.connectWith,q.onstart=b.pubTops(c,a.onalw,a.draggableonstarttopics),q.onstop=b.pubTops(c,a.onalw,a.draggableonstoptopics),q.ondrop=b.pubTops(c,a.onalw,a.droppableondroptopics),c.jqGrid("gridDnD",q)),a.sortableRows&&(b.log("sortable rows for : "+a.id),l=l?{}:eval("( "+h+" )"),l.beforeStop=b.pubTops(c,a.onalw,a.sortableonbeforestoptopics),l.stop=b.pubTops(c,
a.onalw,a.sortableonstoptopics),l.start=b.pubTops(c,a.onalw,a.sortableonstarttopics),l.sort=b.pubTops(c,a.onalw,a.sortableonsorttopics),l.activate=b.pubTops(c,a.onalw,a.sortableonactivatetopics),l.deactivate=b.pubTops(c,a.onalw,a.sortableondeactivatetopics),l.over=b.pubTops(c,a.onalw,a.sortableonovertopics),l.out=b.pubTops(c,a.onalw,a.sortableonouttopics),l.remove=b.pubTops(c,a.onalw,a.sortableonremovetopics),l.receive=b.pubTops(c,a.onalw,a.sortableonreceivetopics),l.change=b.pubTops(c,a.onalw,a.sortableonchangetopics),
l.update=b.pubTops(c,a.onalw,a.sortableonupdatetopics),c.jqGrid("sortableRows",l)),a.navigator&&(p.add=a.navigatoradd,p.del=a.navigatordel,p.edit=a.navigatoredit,p.refresh=a.navigatorrefresh,p.search=a.navigatorsearch,p.view=a.navigatorview,p.cloneToTop=a.cloneToTop,c.jqGrid("navGrid",b.escId(a.pager),p,a.navigatoreditoptions,a.navigatoraddoptions,a.navigatordeleteoptions,a.navigatorsearchoptions,a.navigatorviewoptions),!0===a.editinline&&!0===a.navinline&&c.jqGrid("inlineNav",b.escId(a.pager)),a.navigatorextrabuttons&&
b.navigatorButtons(c,a.navigatorextrabuttons,b.escId(a.pager)),a.cloneToTop&&b.navigatorButtons(c,a.navigatorextrabuttons,b.escId(a.toppagerElem))),a.filter&&(a.filteroptions&&(s=a.filteroptions),c.jqGrid("filterToolbar",s)),a.frozen&&c.jqGrid("setFrozenColumns"),a.resizable&&(b.loadAtOnce||b.require(["js/base/widget"+b.minSuffix+".js","js/base/mouse"+b.minSuffix+".js","js/base/resizable"+b.minSuffix+".js"]),n=n?{}:eval("( "+m+" )"),n.start=b.pubTops(c,a.onalw,a.resizableonstarttopics),n.stop=b.pubTops(c,
a.onalw,a.resizableonstoptopics),n.resize=b.pubTops(c,a.onalw,a.resizableonresizetopics),c.jqGrid("gridResize",n)));a.ongridcompletetopics&&(b.publishTopic(c,a.onalwaystopics,{}),b.publishTopic(c,a.ongridcompletetopics,{}))};a.onfocustopics&&(d.beforeSelectRow=function(f,e){var d={};d.rowid=f;d.e=e;b.publishTopic(c,a.onalw,d);b.publishTopic(c,a.onfocustopics,d)});a.reloadtopics&&h.each(a.reloadtopics.split(","),function(b,d){c.subscribe(d,"_s2j_reloadgrid",a)});d.loadtext||null===b.defaults.loadingText||
(d.loadtext=b.defaults.loadingText);d.loadComplete=b.pubCom(c,a.onalw,a.oncom,null,null,a);d.loadError=b.pubErr(c,a.onalw,a.onerr,a.errortext);a.grouping&&b.require("js/plugins/grid.grouping"+b.minSuffix+".js");a.editurl&&(b.require(["js/plugins/grid.filter"+b.minSuffix+".js","js/plugins/grid.formedit"+b.minSuffix+".js"]),a.editinline&&b.require("js/plugins/grid.inlinedit"+b.minSuffix+".js"));a.cellurl&&b.require("js/plugins/grid.celledit"+b.minSuffix+".js");a.navigator&&b.require("js/plugins/grid.formedit"+
b.minSuffix+".js");a.navigatorsearch&&b.require("js/plugins/grid.filter"+b.minSuffix+".js");a.subgrid?(b.require("js/plugins/grid.subgrid"+b.minSuffix+".js"),d.subGrid=!0,d.gridview=!1,d.subGridRowExpanded=function(d,e){var g={},k=a.subgridoptions,m=d.replace(/(:|\.)/g,"\\$1")+"_table",l=h(b.escId(d)),r="\x3ctable id\x3d'"+m+"' class\x3d'scroll'\x3e\x3c/table\x3e",n=k.url.indexOf("?");g.proceed=!0;a.onsgrowexpanded&&(g.row_id=e,g.subgrid_id=d,b.publishTopic(c,a.onalw,g),b.publishTopic(c,a.onsgrowexpanded,
g));e=escape(e);if(g.proceed){if(k.pager&&""!==k.pager||k.navigator)r=r+"\x3cdiv id\x3d'"+d.replace(/(:|\.)/g,"\\$1")+"_pager'\x3e\x3c/div\x3e",k.pager=d.replace(/(:|\.)/g,"\\$1")+"_pager",k.navigatoraddoptions=h.extend(!0,k.navigatoraddoptions||{},{editData:{rowid:e}}),k.navigatoreditoptions=h.extend(!0,k.navigatoreditoptions||{},{editData:{rowid:e}}),k.navigatordeleteoptions=h.extend(!0,k.navigatordeleteoptions||{},{delData:{rowid:e}});h.each(k.colModel,function(a,c){c.editoptions&&c.editoptions.dataUrl&&
(0<c.editoptions.dataUrl.indexOf("rowid")?c.editoptions.dataUrl=b.changeParam(c.editoptions.dataUrl,"rowid",e):c.editoptions.dataUrl=b.addParam(c.editoptions.dataUrl,"rowid\x3d"+e));c.searchoptions&&c.searchoptions.dataUrl&&(0<c.searchoptions.dataUrl.indexOf("rowid")?c.searchoptions.dataUrl=b.changeParam(c.searchoptions.dataUrl,"rowid",e):c.searchoptions.dataUrl=b.addParam(c.searchoptions.dataUrl,"rowid\x3d"+e))});l.html(r);k.url&&(0<n&&(k.url=k.url.substring(0,n)),k.url=k.url+"?id\x3d"+e);l=h(b.escId(m));
k=b.parseGridParams(l,k,k);l.jqGrid(k)}}):d.gridview=!0;if(a.url){var m="";a.formids&&(b.loadAtOnce||b.require("js/plugins/jquery.form"+b.minSuffix+".js"),h.each(a.formids.split(","),function(a,c){var d=h(b.escId(c)).formSerialize();m=""!==m?m+"\x26"+d:d}));d.url=b.addParam(a.url,m)}return d},grid:function(c,a){var d={};this.log("grid for : "+a.id);this.require("i18n/grid.locale-"+this.gridLocal+".js",function(){h.jgrid.no_legacy_api=!0;h.jgrid.useJSON=!0});this.loadAtOnce||this.require(["js/base/widget"+
this.minSuffix+".js","js/base/mouse"+this.minSuffix+".js","js/base/sortable"+this.minSuffix+".js","js/base/dialog"+this.minSuffix+".js"]);this.require("js/plugins/jquery.jqGrid"+this.minSuffix+".js");this.requireCss("themes/ui.jqgrid.css");if(a.sortable||a.sortableRows)this.loadAtOnce||this.require(["js/base/widget"+this.minSuffix+".js","js/base/mouse"+this.minSuffix+".js","js/base/sortable"+this.minSuffix+".js"]);h.extend(d,a);c.data("_s2jg_init",!1);d=this.parseGridParams(c,a,d);c.jqGrid(d)}};h.extend(!0,
h.struts2_jquery_grid,h.struts2_jquery);h.struts2_jquery_grid.debugPrefix="[struts2_jquery_grid] ";h.subscribeHandler("_s2j_reloadgrid",function(c,a){var d=h.struts2_jquery_grid,b={},m="",f;h.extend(b,c.data);b.id&&(b.url&&b.formids&&(b.formids&&(d.loadAtOnce||d.require("js/plugins/jquery.form"+d.minSuffix+".js"),h.each(b.formids.split(","),function(a,b){var c=h(d.escId(b)).formSerialize();m=""!==m?m+"\x26"+c:c})),b.url=d.addParam(b.url,m)),f=h(d.escId(b.id)),f.jqGrid("setGridParam",{url:b.url}),
d.log("reload grid "+b.id),f.trigger("reloadGrid"))})})(jQuery);